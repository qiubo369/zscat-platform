(function(e){function t(t){for(var s,l,r=t[0],o=t[1],c=t[2],d=0,h=[];d<r.length;d++)l=r[d],i[l]&&h.push(i[l][0]),i[l]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);u&&u(t);while(h.length)h.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],s=!0,r=1;r<a.length;r++){var o=a[r];0!==i[o]&&(s=!1)}s&&(n.splice(t--,1),e=l(l.s=a[0]))}return e}var s={},i={app:0},n=[];function l(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=s,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(a,s,function(t){return e[t]}.bind(null,s));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],o=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=o;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"02dd":function(e,t,a){"use strict";var s=a("6afb"),i=a.n(s);i.a},"0394":function(e,t,a){},"0641":function(e,t,a){},"076f":function(e,t,a){"use strict";var s=a("8aa8"),i=a.n(s);i.a},"11b1":function(e,t,a){"use strict";var s=a("ad01"),i=a.n(s);i.a},1408:function(e,t,a){"use strict";var s=a("7267"),i=a.n(s);i.a},"1dc9":function(e,t,a){},2567:function(e,t,a){},2758:function(e,t,a){},"288b":function(e,t,a){},2939:function(e,t,a){"use strict";var s=a("d80d"),i=a.n(s);i.a},"2eac":function(e,t,a){"use strict";var s=a("2758"),i=a.n(s);i.a},"39ce":function(e,t,a){},"3e9f":function(e,t,a){"use strict";var s=a("288b"),i=a.n(s);i.a},"3fa8":function(e,t,a){"use strict";var s=a("a6a7"),i=a.n(s);i.a},"46be":function(e,t,a){},"4bbc":function(e,t,a){"use strict";var s=a("f11b"),i=a.n(s);i.a},"4c4a":function(e,t,a){},"4e7c":function(e,t,a){"use strict";var s=a("a132"),i=a.n(s);i.a},"4ff4":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("7f7f"),a("ac6a"),a("cadf"),a("551c"),a("097d");var s=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("keep-alive",[e.$route.meta.keepAlive?a("router-view"):e._e()],1),e.$route.meta.keepAlive?e._e():a("router-view")],1)},n=[],l=(a("5c0b"),a("2877")),r={},o=Object(l["a"])(r,i,n,!1,null,null,null);o.options.__file="App.vue";var c=o.exports,u=a("8c4f"),d=a("bc3a"),h=a.n(d),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("el-menu",{staticClass:"el-menu-demo",attrs:{mode:"horizontal","background-color":"#222","text-color":"#fff","active-text-color":"#ffd04b"}},[a("el-menu-item",{attrs:{disabled:"",index:"top_menu"}},[[a("div",{staticClass:"menu-title",attrs:{title:e.title}},[e._v(e._s(e.title))])]],2),e._l(e.menus,function(t,s){return a("el-submenu",{key:s,attrs:{index:String(s)}},[a("template",{slot:"title"},[e._v(e._s(t.label))]),e._l(t.children,function(t,i){return a("el-menu-item",{key:s+"-"+i,attrs:{index:s+"-"+i}},[t.router?a("router-link",{staticClass:"menu-link",attrs:{to:t.href}},[e._v(e._s(t.label))]):a("a",{staticClass:"menu-link",attrs:{href:t.href}},[e._v(e._s(t.label))])],1)})],2)}),e.moreMenus.length>0?a("el-submenu",{key:"5",attrs:{index:"5"}},[a("template",{slot:"title"},[e._v("more")]),e._l(e.moreMenus,function(t,s){return a("el-submenu",{key:6+s,attrs:{index:String(6+s)}},[a("template",{slot:"title"},[e._v(e._s(t.label))]),e._l(t.children,function(t,i){return a("el-menu-item",{key:s+"-"+i,attrs:{index:s+"-"+i}},[t.router?a("router-link",{staticClass:"menu-link",attrs:{to:t.href}},[e._v(e._s(t.label))]):a("a",{staticClass:"menu-link",attrs:{href:t.href}},[e._v(e._s(t.label))])],1)})],2)})],2):e._e()],2),a("div",{staticClass:"userName"},[a("el-dropdown",{attrs:{trigger:"click"},on:{command:e.changePassWord}},[a("span",{staticClass:"el-dropdown-link"},[e._v("\n                "+e._s(e.userName)+"\n                "),a("i",{staticClass:"el-icon-caret-bottom el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"change"}},[e._v("\n                    修改密码\n                ")])],1)],1),a("span",{staticClass:"signOut",on:{click:e.signOut}},[e._v("退出登录")])],1),a("div",{staticClass:"container"},[a("router-view")],1),a("el-dialog",{attrs:{title:"修改密码",visible:e.dialogPassword,width:"600px"},on:{"update:visible":function(t){e.dialogPassword=t}}},[a("div",{staticClass:"dialog-item-password"},[a("div",{staticClass:"dialog-left"},[e._v("\n                老密码：\n            ")]),a("div",{staticClass:"dialog-right"},[a("el-input",{attrs:{type:"password"},model:{value:e.oldPass,callback:function(t){e.oldPass=t},expression:"oldPass"}})],1)]),a("div",{staticClass:"dialog-item-password"},[a("div",{staticClass:"dialog-left"},[e._v("\n                新密码：\n            ")]),a("div",{staticClass:"dialog-right"},[a("el-input",{attrs:{type:"password"},model:{value:e.newPass,callback:function(t){e.newPass=t},expression:"newPass"}})],1)]),a("div",{staticClass:"dialog-item-password"},[a("div",{staticClass:"dialog-left"},[e._v("\n                重复新密码：\n            ")]),a("div",{staticClass:"dialog-right"},[a("el-input",{attrs:{type:"password"},model:{value:e.repeatPass,callback:function(t){e.repeatPass=t},expression:"repeatPass"}})],1)]),a("div",{staticClass:"dialog-bottom"},[a("el-button",{on:{click:function(t){e.dialogPassword=!1}}},[e._v("关 闭")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.savePassword()}}},[e._v("确 定")])],1)])],1)},p=[],f=a("be94"),v=a("2f62"),b={"/tag/list":"/tag/list","/crm/userList":"/crm/userList"},g={name:"entry",data:function(){return{menus:[],moreMenus:[],title:"",userName:"admin",dialogPassword:!1,oldPass:"",newPass:"",repeatPass:""}},computed:Object(f["a"])({},Object(v["c"])({menuList:function(e){return e.menu},userInfo:function(e){return e.userInfo}})),methods:Object(f["a"])({},Object(v["b"])({setMenu:"setMenu",setUserInfo:"setUserInfo",setOperation:"setOperation"}),{getMenus:function(){var e=this;this.$get("/index.json").then(function(t){e.setUserInfo(t.data.object.user),e.setMenu(t.data.object.menuList||[]),e.handleMenu()})},handleMenu:function(){this.healthUrlMap(this.menuList),this.menus=this.menuList.splice(0,5),this.moreMenus=this.menuList,this.title=this.userInfo.showName},healthUrlMap:function(e){e.forEach(function(e){e.children instanceof Array&&e.children.forEach(function(e){b[e.href]&&(e.href=b[e.href],e.router=!0)})})},changePassWord:function(e){"change"===e&&(this.dialogPassword=!0)},savePassword:function(){var e=this,t=this.checkPassword();if(t)this.$alert(t);else{var a={oldPass:this.oldPass,newPass:this.newPass};this.$post("/updatePassword.json",a).then(function(){e.$message.success("密码修改成功"),e.dialogPassword=!1,e.oldPass="",e.newPass="",e.repeatPass=""})}},checkPassword:function(){var e="";return this.newPass.length<6&&(e="新密码不能少于6位"),this.newPass!==this.repeatPass&&(e="您两次输入的新密码不一致,请确认"),this.repeatPass.length||(e="请输入重复新密码"),this.newPass.length||(e="请输入新密码"),this.oldPass.length||(e="请输入老密码"),e},signOut:function(){this.$get("/logout.json").then(function(){return window.location="/login"}).catch(function(){return window.location="/login"})}}),mounted:function(){this.getMenus()}},y=g,_=(a("df69"),Object(l["a"])(y,m,p,!1,null,"6b779542",null));_.options.__file="Entry.vue";var k=_.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("div",{staticClass:"login-box"},[a("h1",[e._v("登录")]),a("div",{staticClass:"item"},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.account,callback:function(t){e.account=t},expression:"account"}},[a("template",{slot:"prepend"},[e._v("用户:")])],2)],1),a("div",{staticClass:"item"},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码"},nativeOn:{keyup:function(t){if(!("button"in t)&&13!==t.keyCode)return null;e.login()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}},[a("template",{slot:"prepend"},[e._v("密码:")])],2)],1),a("div",{staticClass:"item"},[a("el-button",{attrs:{type:"success"},on:{click:function(t){e.login()}}},[e._v("登录")])],1)])])},w=[],S={name:"login",components:{},data:function(){return{account:"",password:""}},methods:{login:function(){var e=this;return this.account?this.password?(this.$loading("登录中..."),this.$get("/login.json",{account:this.account,password:this.password}).then(function(){e.$router.push("/index"),e.$loading().close()}).catch(function(){return e.$loading().close()}),""):this.$message.error("请输入密码"):this.$message.error("请输入用户名")}}},x=S,$=(a("02dd"),Object(l["a"])(x,C,w,!1,null,"50e87a6c",null));$.options.__file="Login.vue";var I=$.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("div",{staticClass:"warning-box"},[e._v("\n        小哥哥小姐姐们，不要慌，我去火星待会\n        "),a("div",{staticClass:"btn-div"},[a("el-button",{staticClass:"right-btn",attrs:{type:"success",round:""},on:{click:function(t){e.goBack()}}},[e._v("返回")])],1)])])},T=[],D={name:"notFound",props:[],created:function(){},methods:{goBack:function(){this.$router.push("/index")}},mounted:function(){}},j=D,P=(a("e7aa"),Object(l["a"])(j,L,T,!1,null,"0b2db59b",null));P.options.__file="NotFound.vue";var N=P.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("div",{staticClass:"header"},[e._v("\n    增加关联关系\n    "),a("div",{staticClass:"back-btn"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.back()}}},[e._v("返回")])],1)]),a("div",{staticClass:"content"},[a("div",{staticClass:"item"},[a("div",{staticClass:"item-title"},[a("span",[e._v("关联关系")]),a("span",{staticClass:"font-blue"},[e._v("已关联 "+e._s(e.categoryNum)+" 个类目，共 "+e._s(e.totalNum)+" 个关联")])]),a("div",{staticClass:"item-content"},[a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("用户关联数量：")]),e._v("\n          "+e._s(e.userRelationNum)+"\n        ")]),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("食材关联数量：")]),e._v("\n          "+e._s(e.ingredientsRelationNum)+"\n        ")]),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("营销软文关联数量：")]),e._v("\n          "+e._s(e.marketingRelationNum)+"\n        ")])])]),a("div",{staticClass:"item"},[e._m(0),a("div",{staticClass:"item-content"},[a("span",[e._v("选择关联类目：")]),a("el-select",{attrs:{size:"small"},on:{change:function(t){e.categoryChange()}},model:{value:e.category,callback:function(t){e.category=t},expression:"category"}},e._l(e.categoryList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)]),a("div",{staticClass:"item"},[a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){e.search()}}},[e._v("查询结果")]),a("br"),a("br"),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){e.clearSearch()}}},[e._v("清除筛选")])],1),a("div",{staticClass:"item-content",class:"3"===e.category?"min-height":""},[e._l(e.searchList,function(t,s){return a("div",{key:s,staticClass:"item-list",class:"time"===t.type||"input"===t.type?"item-block":""},["input"!==t.type?a("span",{staticClass:"search-name"},[e._v("\n            "+e._s(t.name)+"：\n          ")]):e._e(),a("div",{staticClass:"search-content",class:"time"===t.type?"search-time":"input"===t.type?"search-input":""},["select"===t.type?a("div",[a("el-select",{attrs:{size:"small"},model:{value:e.searchData[t.key],callback:function(a){e.$set(e.searchData,t.key,a)},expression:"searchData[item.key]"}},e._l(t.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.value||e.id}})}))],1):e._e(),"integer"===t.type||"decimal"===t.type?a("div",[a("div",{staticClass:"search-input"},[a("el-input",{attrs:{size:"small",type:"number",placeholder:"请输入"},model:{value:e.searchData[t.key+"Min"],callback:function(a){e.$set(e.searchData,t.key+"Min",a)},expression:"searchData[item.key+'Min']"}})],1),e._v("\n              至\n              "),a("div",{staticClass:"search-input"},[a("el-input",{attrs:{size:"small",type:"number",placeholder:"请输入"},model:{value:e.searchData[t.key+"Max"],callback:function(a){e.$set(e.searchData,t.key+"Max",a)},expression:"searchData[item.key+'Max']"}})],1),a("span",{staticClass:"clear",on:{click:function(t){e.clear(s)}}},[e._v("清除")])]):e._e(),"time"===t.type?a("div",[a("el-date-picker",{attrs:{type:"datetime",size:"small","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始日期时间"},model:{value:e.searchData[t.key+"Min"],callback:function(a){e.$set(e.searchData,t.key+"Min",a)},expression:"searchData[item.key+'Min']"}}),e._v("\n              至\n              "),a("el-date-picker",{attrs:{type:"datetime",size:"small","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束日期时间"},model:{value:e.searchData[t.key+"Max"],callback:function(a){e.$set(e.searchData,t.key+"Max",a)},expression:"searchData[item.key+'Max']"}}),a("span",{staticClass:"clear",on:{click:function(t){e.clear(s)}}},[e._v("清除")])],1):e._e(),"input"===t.type?a("div",[a("el-input",{attrs:{size:"small",placeholder:t.placeholder},model:{value:e.searchData[t.key],callback:function(a){e.$set(e.searchData,t.key,a)},expression:"searchData[item.key]"}})],1):e._e()])])}),a("div",{staticClass:"item-list tag-box"},[a("div",{staticClass:"search-name"},[e._v("\n            标签筛选：\n          ")]),a("label-picker",{ref:"tagList",staticClass:"tag-chosen-field",attrs:{searchFunc:e.searchFunc,labels:e.labels,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0)},on:{pickLabel:e.pickLabel,deleteLabel:e.deleteLabel}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.resultShow,expression:"resultShow"}],staticClass:"search-result"},[e._v("\n          当前类目筛选结果为 "+e._s(e.searchResult.length)+" 个\n          "),a("el-button",{attrs:{type:"primary",disabled:!e.searchResult.length,size:"mini"},on:{click:function(t){e.connect()}}},[e._v("将当前筛选结果添加关联")])],1)],2)])])])},E=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("类目")])])}],R=(a("386d"),a("c5f6"),[{name:"一级类型",type:"select",list:[{name:"全部",value:"0"}],key:"type"},{name:"二级类型",type:"select",list:[{name:"全部",value:"0"}],key:"subType"},{name:"供能类型",type:"select",list:[{name:"全部",value:"0"},{name:"碳水类供能",value:"1"},{name:"蛋白类供能",value:"2"},{name:"脂肪类供能",value:"3"},{name:"酒精类供能",value:"4"},{name:"不计供能",value:"5"}],key:"powerType"},{name:"颜色",type:"select",list:[],key:"color"},{name:"生物类型",type:"select",list:[{name:"全部",value:"0"}],key:"speciesType"},{name:"上市月份",type:"integer",key:"availableMonth"},{name:"卡路里",type:"decimal",key:"calorie"},{name:"碳水化合物",type:"decimal",key:"carbohydrate"},{name:"脂肪",type:"decimal",key:"fat"},{name:"蛋白质",type:"decimal",key:"protein"},{name:"膳食纤维",type:"decimal",key:"cellulose"},{name:"维生素A",type:"decimal",key:"va"},{name:"维生素C",type:"decimal",key:"vc"},{name:"维生素E",type:"decimal",key:"ve"},{name:"胡萝卜素",type:"decimal",key:"carotene"},{name:"硫胺素",type:"decimal",key:"aneurin"},{name:"核黄素",type:"decimal",key:"riboflavin"},{name:"烟酸",type:"decimal",key:"niacin"},{name:"胆固醇",type:"decimal",key:"cholesterol"},{name:"镁",type:"decimal",key:"mg"},{name:"钙",type:"decimal",key:"ca"},{name:"铁",type:"decimal",key:"fe"},{name:"锌",type:"decimal",key:"zn"},{name:"铜",type:"decimal",key:"cu"},{name:"锰",type:"decimal",key:"mn"},{name:"钾",type:"decimal",key:"k"},{name:"磷",type:"decimal",key:"p"},{name:"钠",type:"decimal",key:"na"},{name:"硒",type:"decimal",key:"se"},{name:"饱腹指数",type:"decimal",key:"satiety"},{name:"卵磷脂",type:"decimal",key:"lecithin"},{name:"DHA",type:"decimal",key:"dha"},{name:"EPA",type:"decimal",key:"epa"},{name:"n-6脂肪酸",type:"decimal",key:"fattyAcid6"},{name:"n-3脂肪酸",type:"decimal",key:"fattyAcid3"},{name:"创建时间",type:"time",key:"createTime"},{name:"被打卡次数",type:"integer",key:"applyCount"},{name:"",type:"input",key:"searchKeyword",placeholder:"食材编号/食材名称"}]),z=[{name:"注册渠道",type:"select",list:[{name:"全部",value:"0"}],key:"registerChannel"},{name:"用户来源",type:"select",list:"",key:"userSource"},{name:"国家",type:"select",list:[{name:"全部",value:"全部"},{name:"中国大陆",value:"中国大陆"},{name:"美洲国家",value:"美洲国家"},{name:"中国香港/中国台湾/澳洲/亚洲其他国家",value:"中国香港/中国台湾/澳洲/亚洲其他国家"},{name:"欧洲国家",value:"欧洲国家"},{name:"非洲国家",value:"非洲国家"}],key:"country"},{name:"性别",type:"select",list:[{name:"全部",value:"ALL"},{name:"男",value:"M"},{name:"女",value:"F"}],key:"gender"},{name:"婚姻状况",type:"select",list:[{name:"全部",value:"0"}],key:"maritalStatus"},{name:"生育情况",type:"select",list:[{name:"全部",value:"0"},{name:"已生育",value:"1"},{name:"未生育",value:"2"}],key:"parentalStatus"},{name:"年龄",type:"integer",key:"age"},{name:"服务商品客单价",type:"decimal",key:"serviceGoodsPrice"},{name:"实物商品客单价",type:"decimal",key:"physicalGoodsPrice"},{name:"BMI",type:"decimal",key:"bmi"},{name:"服务商品消费",type:"decimal",key:"serviceGoodsConsume"},{name:"实物商品消费",type:"decimal",key:"physicalGoodsConsume"},{name:"服务商品订单数量",type:"integer",key:"serviceGoodsOrderNum"},{name:"实物商品订单数量",type:"integer",key:"physicalGoodsOrderNum"},{name:"宝宝生日",type:"time",key:"babyBirthday"},{name:"用户生日",type:"time",key:"userBirthday"},{name:"注册时间",type:"time",key:"userRegister"},{name:"",type:"input",key:"searchKeyword",placeholder:"用户编码/姓名/微信号/手机号"}],F=[{name:"",type:"input",key:"searchKeyword",placeholder:"软文编号/软文标题"},{name:"创建时间",type:"time",key:"createTime"}],B=[{name:"标签大类",type:"select",list:[{name:"全部",value:"0"},{name:"用户标签",value:"1"},{name:"内容标签",value:"2"},{name:"兼容标签",value:"3"}],key:"labelPartition"},{name:"标签分组",type:"select",list:[],key:"labelGroupId"},{name:"标签类型",type:"select",list:[{name:"全部",value:"0"},{name:"手动标签",value:"1"},{name:"自动标签",value:"2"}],key:"labelType"},{name:"标签展示类型",type:"select",list:[{name:"全部",value:"0"},{name:"用户端不展示",value:"1"},{name:"用户端展示",value:"2"}],key:"isUserShow"},{name:"标签状态",type:"select",list:[{name:"全部",value:"0"},{name:"激活",value:"1"},{name:"已停用",value:"2"}],key:"labelStatus"},{name:"创建时间",type:"time",key:"createTime"},{name:"",type:"input",key:"searchKeyword",placeholder:"标签名称/标签编号"}],U=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"label-wrapper"},[a("pick-list-popover",{ref:"popover",attrs:{data:e.searchLabels,"refresh-after-hide":e.refreshAfterHide,"auto-search":e.autoSearch,debounce:e.debounce,searchFunc:e.searchFunc,placeHolder:e.placeHolder,disabled:e.disabled},on:{pick:e._pickLabel}},[a("template",{slot:"list"},[a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"search-list-item"},[e._v("\n                        "+e._s(t.row.labelName)+"\n                    ")])]}}])})],1),a("template",{slot:"icon"},[a("div",{staticClass:"icon-wrapper",class:e.disabled?"icon-not-allow":"",attrs:{slot:"reference"},slot:"reference"},[a("i",{staticClass:"el-icon-circle-plus-outline icon-line-height-fix"})])])],2),a("ft-labels",{staticClass:"labels",attrs:{labels:e.labels},on:{deleteLabel:e._deleteLabel}})],1)},O=[],q={name:"label-picker",props:{searchFunc:{type:Function,default:function(){return Promise.resolve([])}},labels:{type:Array,default:function(){return[]}},searchLabels:{type:Array,default:function(){return[]}},autoSearch:{type:Boolean,default:!1},refreshAfterHide:{type:Boolean,default:!1},placeHolder:{type:String,default:"请输入内容"},debounce:{type:Number,default:300},disabled:{type:Boolean,default:!1}},data:function(){return{deletingLabel:{},dialogVisible:!1}},methods:{_pickLabel:function(e){this.$emit("pickLabel",e,this.labels)},_deleteLabel:function(e,t){e>-1&&this.$emit("deleteLabel",this.labels[e],t)},search:function(e){this.$refs.popover.search(e)}}},A=q,H=(a("3fa8"),Object(l["a"])(A,U,O,!1,null,"4239d000",null));H.options.__file="label-picker.vue";var G=H.exports,Q=a("b17e"),V={name:"addRelation",components:{labelPicker:G},props:["id","type"],data:function(){return{originalSearchData:"",labelId:"",category:"",categoryList:[],searchList:[],foodList:R,userList:z,textList:F,searchData:{},resultShow:!1,userRelationNum:0,ingredientsRelationNum:0,marketingRelationNum:0,categoryNum:0,totalNum:0,labels:[],searchResult:[]}},created:function(){var e=this.$route.query.type;this.tagType=e,this.labelId=this.$route.query.id,"1"===e&&(this.categoryList=[{label:"用户",value:"1"}],this.searchList=this.userList),"2"===e&&(this.categoryList=[{label:"食材",value:"2"},{label:"营销软文",value:"3"}],this.searchList=this.foodList),"3"===e&&(this.categoryList=[{label:"用户",value:"1"},{label:"食材",value:"2"},{label:"营销软文",value:"3"}],this.searchList=this.userList),this.category=this.categoryList[0].value,this.resetSearchData(),this.getColorList(),this.getRegisterChannelsList(),this.getDetail()},methods:{back:function(){this.$router.push("/tag/detail?id=".concat(this.labelId))},resetSearchData:function(){var e=this;this.searchData={labelIdList:""},this.searchList.forEach(function(t){"select"===t.type?e.$set(e.searchData,t.key,t.list.length&&t.list[0].value||"0"):"input"===t.type?e.$set(e.searchData,t.key,""):(e.$set(e.searchData,"".concat(t.key,"Min"),""),e.$set(e.searchData,"".concat(t.key,"Max"),""))}),this.labels=[],this.originalSearchData=Q.clone(this.searchData)},getDetail:function(){var e=this;this.$get("/crm/label/detail.json",{labelId:this.labelId}).then(function(t){var a=t.data.object;e.userRelationNum=a.userRelationNum,e.ingredientsRelationNum=a.ingredientsRelationNum,e.marketingRelationNum=a.marketingRelationNum,e.categoryNum=(e.userRelationNum?1:0)+(e.ingredientsRelationNum?1:0)+(e.marketingRelationNum?1:0),e.totalNum=e.userRelationNum+e.ingredientsRelationNum+e.marketingRelationNum})},getColorList:function(){var e=this;this.$get("/crm/label/ingreIds/colors.json",{labelId:this.labelId}).then(function(t){var a=t.data.object,s=[{name:"全部",value:"0"}];a.forEach(function(e){s.push({name:e,value:e})}),e.foodList[3].list=s}).catch(function(e){return console.log(e)})},getRegisterChannelsList:function(){var e=this;this.$get("/crm/label/user/registerChannels.json",{labelId:this.labelId}).then(function(t){e.userList[1].list=t.data.object,e.userList[1].list.unshift({id:"0",name:"全部"})}).catch(function(e){return console.log(e)})},search:function(){var e=this.checkData();return e?this.$alert(e):(this.getList(),"")},checkData:function(){for(var e="",t=this.searchList.length-1;t>=0;t--){var a=this.searchList[t],s=parseFloat(this.searchData["".concat(a.key,"Max")])||0,i=parseFloat(this.searchData["".concat(a.key,"Min")])||0;if("integer"===a.type&&((s&&i&&s<i||i<0||s<0)&&(e="".concat(a.name,"最小值不能大于最大值")),s&&s%1!==0&&(e="".concat(a.name,"最大值只能为整数")),s&&s<0&&(e="".concat(a.name,"最大值不能小于0")),i&&i%1!==0&&(e="".concat(a.name,"最小值只能为整数")),i&&i<0&&(e="".concat(a.name,"最小值不能小于0"))),"decimal"===a.type&&((s&&i&&s<i||i<0||s<0)&&(e="".concat(a.name,"最小值不能大于最大值")),s&&(s<0?e="".concat(a.name,"最大值不能小于0"):this.searchData["".concat(a.key,"Max")]=Number(s).toFixed(1)),i&&(i<0?e="".concat(a.name,"最小值不能小于0"):this.searchData["".concat(a.key,"Min")]=Number(i).toFixed(1))),"time"===a.type){var n=new Date(this.searchData["".concat(a.key,"Max")]).getTime(),l=new Date(this.searchData["".concat(a.key,"Min")]).getTime();n&&l&&n<l&&(e="".concat(a.name,"开始时间不能大于结束时间"))}"上市月份"===a.name&&(s&&(s<1||s>12)&&(e="".concat(a.name,"最大值只能输入1-12之间的正整数")),i&&(i<1||i>12)&&(e="".concat(a.name,"最小值只能输入1-12之间的正整数")))}return e},getList:function(){var e=this,t="";"1"===this.category&&(t="userIds"),"2"===this.category&&(t="ingreIds"),"3"===this.category&&(t="marketingIds"),this.searchData.labelIdList="",this.labels.length&&(this.labels.forEach(function(t){e.searchData.labelIdList+="".concat(t.labelId,",")}),this.searchData.labelIdList=this.searchData.labelIdList.substring(0,this.searchData.labelIdList.length-1)),"1"===this.category&&Q.equals(this.searchData,this.originalSearchData)?this.$message.error("请至少填写一项过滤条件"):(this.$loading("加载中..."),this.$get("/crm/label/".concat(t,".json"),this.searchData).then(function(t){e.searchResult=t.data.object||[]}).catch(function(e){return console.log(e)}).finally(function(){return e.$loading().close()}),this.resultShow=!0)},clearSearch:function(){this.resetSearchData(),this.resultShow=!1},categoryChange:function(){"1"===this.category&&(this.searchList=this.userList),"2"===this.category&&(this.searchList=this.foodList),"3"===this.category&&(this.searchList=this.textList),this.$refs.tagList.search(),this.resetSearchData()},clear:function(e){this.searchData["".concat(this.searchList[e].key,"Min")]="",this.searchData["".concat(this.searchList[e].key,"Max")]=""},connect:function(){var e=this;this.$confirm("确定则立即执行关联，每次关联仅对当前所筛选的类目生效，如需关联多个类目请分别执行添加。注意：一旦关联，不可撤销、不可批量解除。如需解除关联将标签整体删除，则关联关系同步会删除。","确认要将筛选结果关联到当前标签吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t="";e.searchResult.forEach(function(e){t+="".concat(e,",")}),t=t.substring(0,t.length-1);var a=e.category;"3"===a&&(a="6");var s={relationIds:t,labelId:e.labelId,relationType:a};e.$loading("关联中..."),e.$post("/crm/label/addRelation.json",s).then(function(){e.$message.success("关联成功!"),e.resultShow=!1,e.getDetail(),e.resetSearchData()})}).catch(function(e){return console.log(e)}).finally(function(){e.$loading().close()})},searchFunc:function(e){var t={1:"1,3",2:"2,3",3:"2,3"},a={labelType:0,labelPartitions:t[this.category]||"0",labelGroupId:0};return e&&(a.labelName=e),this.$get("/crm/label/search.json",a).then(function(e){var t=e.data.object;return t&&t.length?(t.forEach(function(e){e.closable=!0}),Promise.resolve(t)):Promise.resolve([])})},pickLabel:function(e){var t=this.labels.indexOf(e);return t>-1?this.$message.error("已选择此标签"):(this.labels.push(e),"")},deleteLabel:function(e){var t=this.labels.indexOf(e);t>-1&&this.labels.splice(t,1)}}},K=V,W=(a("2eac"),Object(l["a"])(K,M,E,!1,null,"e6c03cc6",null));W.options.__file="AddRelation.vue";var J=W.exports,Z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("div",{staticClass:"header"},[e._v("\n        "+e._s("add"===e.type?"新建标签":"标签详情")+"\n        "),a("div",{staticClass:"back-btn"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEditAndDeleteBtnShow,expression:"isEditAndDeleteBtnShow"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){e.deleteTag()}}},[e._v("删除标签")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEditAndDeleteBtnShow,expression:"isEditAndDeleteBtnShow"}],attrs:{type:"warning",size:"mini"},on:{click:function(t){e.editBtnClick()}}},[e._v("编辑")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit&&"look"===e.type&&"1"===e.params.labelType,expression:"isEdit && type === 'look' && params.labelType === '1'"}],attrs:{size:"mini"},on:{click:function(t){e.save()}}},[e._v("保存")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"add"===e.type,expression:"type === 'add'"}],attrs:{size:"mini",type:"success"},on:{click:function(t){e.save()}}},[e._v("提交")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.back()}}},[e._v("返回")])],1)]),a("div",{staticClass:"content"},[a("div",{staticClass:"item"},[e._m(0),a("div",{staticClass:"item-content"},[e._l(e.showList,function(t,s){return a("div",{key:s,staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v(e._s(t.name)+"：")]),a("el-select",{attrs:{disabled:e.isDisabled(t),size:"small"},on:{change:function(a){e.selectChange(t)}},model:{value:e.params[t.key],callback:function(a){e.$set(e.params,t.key,a)},expression:"params[item.key]"}},e._l(t.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.name||e.labelGroupName,value:e.value||e.labelGroupId}})}))],1)}),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("标签名称：")]),a("div",{staticClass:"input-box"},[a("el-input",{attrs:{disabled:e.isShow2,maxlength:"30",size:"small"},model:{value:e.params.labelName,callback:function(t){e.$set(e.params,"labelName",t)},expression:"params.labelName"}}),"add"===e.type?a("p",{staticClass:"explain"},[e._v("标签名称最长不超过30字符，用于用户端展示的标签，推荐不超过5个字符")]):e._e()],1)]),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("备注：")]),a("div",{staticClass:"input-box"},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容",disabled:e.isShow2,resize:"none",maxlength:"100"},model:{value:e.params.remark,callback:function(t){e.$set(e.params,"remark",t)},expression:"params.remark"}}),"add"===e.type?a("p",{staticClass:"explain"},[e._v("请为标签添加必要的备注，对标签的规则或范围做完整地概括，最长不超过100字符")]):e._e()],1)]),a("div",{staticClass:"line"}),"look"===e.type?a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("创建时间：")]),e._v("\n                    "+e._s(e.createTime||"")+"\n                ")]):e._e(),"look"===e.type?a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("更新时间：")]),e._v("\n                    "+e._s(e.lastUpdateTime||"")+"\n                ")]):e._e(),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("标签状态：")]),e._v("\n                    "+e._s(e.labelStatus||"")+"\n                ")])],2)]),"look"===e.type?a("div",{staticClass:"item"},[a("div",{staticClass:"item-title"},[a("span",[e._v("关联关系")]),a("span",{staticClass:"font-blue"},[e._v("已关联 "+e._s(e.categoryNum)+" 个类目，共 "+e._s(e.totalNum)+" 个关联")]),"1"===e.params.labelType&&"look"===e.type&&"1"===e.params.labelStatus?a("div",{staticClass:"back-btn"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.addRelation()}}},[e._v("增加关联关系")])],1):e._e()]),a("div",{staticClass:"item-content"},[a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("用户关联数量：")]),e._v("\n                    "+e._s(e.userRelationNum)+"\n                ")]),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("食材关联数量：")]),e._v("\n                    "+e._s(e.ingredientsRelationNum)+"\n                ")]),a("div",{staticClass:"list"},[a("span",{staticClass:"list-name"},[e._v("营销软文关联数量：")]),e._v("\n                    "+e._s(e.marketingRelationNum)+"\n                ")])])]):e._e()])])},Y=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("标签基础信息")])])}];a("a481");function X(e){return e.substring(e.length-2,e.length)}function ee(e,t){if(!e)return"";var a=new Date(e),s=1900+a.getYear(),i="0".concat(a.getMonth()+1),n="0".concat(a.getDate()),l="0".concat(a.getHours()),r="0".concat(a.getMinutes()),o="0".concat(a.getSeconds()),c="".concat(s,"-").concat(X(i),"-").concat(X(n)),u="".concat(X(l),":").concat(X(r),":").concat(X(o)),d="hour"===t?"".concat(c," ").concat(u):c;return d}var te={returnDate:ee},ae=JSON.parse(JSON.stringify(B)),se={name:"tagDetail",props:["id"],data:function(){return{showList:ae,type:"add",isEdit:!1,params:{labelStatus:"",remark:"",labelName:"",labelPartition:"",labelGroupId:"",labelType:"",isUserShow:""},createTime:"",lastUpdateTime:"",userRelationNum:0,ingredientsRelationNum:0,marketingRelationNum:0,categoryNum:0,totalNum:0}},computed:{isEditAndDeleteBtnShow:function(){return!this.isEdit&&"look"===this.type&&"1"===this.params.labelType&&"2"===this.params.labelStatus},isShow2:function(){return!this.isEdit&&"look"===this.type||"2"===this.params.labelType},labelStatus:function(){var e={1:"激活",2:"已停用"};return e[this.params.labelStatus]||""}},created:function(){var e=this;this.showList.splice(4,3),this.showList.forEach(function(t){t.list.length&&(t.list[0].name="请选择"),e.$set(e.params,t.key,"0")}),this.getTagGroupList(),this.params.labelId=this.$route.query.id||"",this.type=this.params.labelId?"look":"add",this.params.labelId||(this.params.labelType="1",this.params.labelStatus="1"),this.params.labelId&&this.getDetail()},methods:{returnDate:function(e){return te.returnDate(e,"hour")},isDisabled:function(e){return"标签类型"===e.name||"look"===this.type&&!this.isEdit||"look"===this.type&&this.isEdit&&("标签大类"===e.name||"标签分组"===e.name)||"2"===this.params.labelType||"1"===this.params.labelPartition&&"标签分组"===e.name},selectChange:function(e){"标签大类"===e.name&&"1"===this.params.labelPartition&&(this.params.labelGroupId="0")},back:function(){this.isEdit?(this.isEdit=!1,this.getDetail()):this.$router.push("/tag/list")},getDetail:function(){var e=this;this.$loading("加载中..."),this.$get("/crm/label/detail.json",{labelId:this.params.labelId}).then(function(t){var a=t.data.object,s=["labelPartition","labelGroupId","isUserShow","labelStatus","labelType"];s.forEach(function(t){null!==a[t]&&(a[t]="".concat(a[t])),e.params[t]=a[t]}),e.params.labelName=a.labelName,e.createTime=e.returnDate(a.createTime),e.lastUpdateTime=e.returnDate(a.lastUpdateTime),e.params.remark=a.remark,e.userRelationNum=a.userRelationNum,e.ingredientsRelationNum=a.ingredientsRelationNum,e.marketingRelationNum=a.marketingRelationNum,e.categoryNum=e.categoryNum+(e.userRelationNum?1:0)+(e.ingredientsRelationNum?1:0)+(e.marketingRelationNum?1:0),e.totalNum=e.userRelationNum+e.ingredientsRelationNum+e.marketingRelationNum}).finally(function(){e.$loading().close()})},deleteTag:function(){var e=this;this.$confirm("确定则立即执行删除，不可撤销。标签的所有类目的关联关系均会同步删除。","确认要删除当前标签吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$loading("加载中..."),e.$get("/crm/label/delete.json",{labelIds:e.params.labelId}).then(function(){e.$message.success("操作成功"),e.$router.push("/tag/list")}).cath(function(e){return console.log(e)}).finally(function(){e.$loading().close()})}).catch(function(e){return console.log(e)})},save:function(){var e=this,t=this.checkData();return t?this.$message.error(t):(this.$loading("加载中..."),this.$post("/crm/label/addLabel.json",this.params).then(function(t){if(e.$message.success("提交成功"),t&&t.data&&t.data.object){var a=t.data.object.labelId;e.$router.replace("/tag/detail?id=".concat(a)),e.type="look",e.params.labelId=a,e.isEdit=!1,e.getDetail()}}).catch(function(e){return console.log(e)}).finally(function(){e.$loading().close()}),"")},checkData:function(){var e="";return this.params.remark||(e="备注信息有误"),this.params.labelName||(e="标签名称信息有误"),"0"===this.params.isUserShow&&(e="标签展示类型信息有误"),"0"===this.params.labelGroupId&&"1"!==this.params.labelPartition&&(e="标签分组信息有误"),"0"===this.params.labelPartition&&(e="标签大类信息有误"),e},addRelation:function(){this.$router.push("/addRelation?id=".concat(this.params.labelId,"&type=").concat(this.params.labelPartition))},getTagGroupList:function(){var e=this;this.$get("/crm/label/group/list.json").then(function(t){var a=t.data.object;a instanceof Array&&(a=a.map(function(e){return Object(f["a"])({},e,{labelGroupId:"".concat(e.labelGroupId)})})),e.showList[1].list=a,e.showList[1].list.unshift({labelGroupId:"0",labelGroupName:"请选择"})}).catch(function(e){return console.log(e)})},editBtnClick:function(){this.isEdit=!0}}},ie=se,ne=(a("2939"),Object(l["a"])(ie,Z,Y,!1,null,"4db703d6",null));ne.options.__file="TagDetail.vue";var le=ne.exports,re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("div",{staticClass:"header"},[e._v("\n        标签管理\n    ")]),a("div",{staticClass:"content"},[a("div",{staticClass:"item"},[a("div",{staticClass:"item-title"},[a("span",[e._v("筛选")]),a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showScreen()}}},[e._v(e._s(e.screen?"收起":"展开")+"筛选")]),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){e.search()}}},[e._v("查询结果")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.screen,expression:"screen"}],staticClass:"item-content"},[a("div",{staticClass:"search-box"},[a("div",{staticClass:"clear-box"},[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){e.clearSearch()}}},[e._v("清除筛选")])],1)]),e._l(e.searchList,function(t,s){return a("div",{key:s,staticClass:"item-list",class:"time"===t.type||"input"===t.type?"item-block":""},["input"!==t.type?a("span",{staticClass:"search-name"},[e._v("\n                        "+e._s(t.name)+"：\n                    ")]):e._e(),a("div",{staticClass:"search-content",class:"time"===t.type?"search-time":"input"===t.type?"search-input":""},["select"===t.type?a("div",[a("el-select",{attrs:{size:"small",disabled:"1"===e.showSearchData.labelPartition&&"标签分组"===t.name},on:{change:function(a){e.selectChange(t)}},model:{value:e.showSearchData[t.key],callback:function(a){e.$set(e.showSearchData,t.key,a)},expression:"showSearchData[item.key]"}},e._l(t.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.name||e.labelGroupName,value:e.value||e.labelGroupId}})}))],1):e._e(),"time"===t.type?a("div",[a("el-date-picker",{attrs:{type:"datetime",size:"small","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始日期时间"},model:{value:e.showSearchData[t.key+"Min"],callback:function(a){e.$set(e.showSearchData,t.key+"Min",a)},expression:"showSearchData[`${item.key}Min`]"}}),e._v("\n                            至\n                            "),a("el-date-picker",{attrs:{type:"datetime",size:"small","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束日期时间"},model:{value:e.showSearchData[t.key+"Max"],callback:function(a){e.$set(e.showSearchData,t.key+"Max",a)},expression:"showSearchData[`${item.key}Max`]"}}),a("span",{staticClass:"clear",on:{click:function(t){e.clear(s)}}},[e._v("清除")])],1):e._e(),"input"===t.type?a("div",[a("el-input",{attrs:{size:"small",placeholder:t.placeholder},model:{value:e.showSearchData[t.key],callback:function(a){e.$set(e.showSearchData,t.key,a)},expression:"showSearchData[item.key]"}})],1):e._e()])])})],2)]),a("div",{staticClass:"item"},[a("div",{staticClass:"item-title"},[a("span",[e._v("数据列表")]),a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.addNew()}}},[e._v("新建标签")])],1)]),a("div",{staticClass:"item-content padding0"},[a("ft-table",{ref:"myTable",attrs:{border:"","tooltip-effec":"dark",data:e.dataList,"has-item":e.hasItem,"equal-item":e.equalItem},on:{pickListChange:e.pickListChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"labelId",label:"标签编号"}}),a("el-table-column",{attrs:{prop:"labelName",label:"标签名称"}}),a("el-table-column",{attrs:{prop:"labelPartitionName",label:"标签大类"}}),a("el-table-column",{attrs:{prop:"labelGroupName",label:"标签分组"}}),a("el-table-column",{attrs:{prop:"labelTypeName",label:"标签类型"}}),a("el-table-column",{attrs:{prop:"isUserShowName",label:"标签展示类型"}}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e.returnDate(t.row.createTime))+"\n                        ")]}}])}),a("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e.returnDate(t.row.lastUpdateTime))+"\n                        ")]}}])}),a("el-table-column",{attrs:{prop:"labelStatusName",label:"标签状态"}}),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"middle"},on:{click:function(a){e.lookLabel(t.row.labelId)}}},[e._v("查看")]),"激活"===t.row.labelStatusName?a("el-button",{attrs:{type:"text",disabled:"自动标签"===t.row.labelTypeName,size:"middle"},on:{click:function(a){e.changeLabel(t.row.labelId,2)}}},[e._v("停用")]):a("el-button",{attrs:{type:"text",disabled:"自动标签"===t.row.labelTypeName,size:"middle"},on:{click:function(a){e.changeLabel(t.row.labelId,1)}}},[e._v("激活")]),a("el-button",{attrs:{type:"text",disabled:!(1===t.row.labelType&&2===t.row.labelStatus),size:"middle"},on:{click:function(a){e.deleteLabel(t.row.labelId)}}},[e._v("删除")])]}}])})],1)],1),a("div",{staticClass:"table-footer"},[a("div",{staticClass:"pick-box"},[a("span",{staticClass:"num"},[e._v("已选 "+e._s(e.pickedCount)+" / "+e._s(e.total))]),a("el-dropdown",{on:{command:e.handleCommand}},[a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("\n                            批量操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"stop"}},[e._v("停用所选")]),a("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除所选")]),a("el-dropdown-item",{attrs:{command:"activate"}},[e._v("激活所选")])],1)],1)],1),a("div",{staticClass:"page-box"},[a("el-pagination",{attrs:{"current-page":e.searchData.page,"page-sizes":[10,20,50],"page-size":e.searchData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.pageSizeChange,"current-change":e.pageChange}})],1)])])])])},oe=[],ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{ref:"myTable",style:e.myStyle,attrs:{data:e.data,height:e.height,"max-height":e.maxHeight,stripe:e.stripe,border:e.border,size:e.size,fit:e.fit,"show-header":e.showHeader,"highlight-current-row":e.highlightCurrentRow,"current-row-key":e.currentRowKey,"row-class-name":e.rowClassName,"row-style":e.rowStyle,"cell-class-name":e.cellClassName,"cell-style":e.cellStyle,"header-row-class-name":e.headerRowClassName,"header-row-style":e.headerRowStyle,"header-cell-class-name":e.headerCellClassName,"header-cell-style":e.headerCellStyle,"row-key":e.rowKey,"empty-text":e.emptyText,"default-expand-all":e.defaultExpandAll,"expand-row-keys":e.expandRowKeys,"default-sort":e.defaultSort,"tooltip-effec":e.tooltipEffect,"show-summary":e.showSummary,"sum-text":e.sumText,"summary-method":e.summaryMethod,"span-method":e.spanMethod,"select-on-indeterminate":e.selectOnIndeterminate},on:{select:e._pickChange,"select-all":e._pickChange,"selection-change":e._selectionChange,"cell-mouse-enter":e._cellMouseEnter,"cell-mouse-leave":e._cellMouseLeave,"cell-click":e._cellClick,"cell-dblclick":e._cellDblClick,"row-click":e._rowClick,"row-contextmenu":e._rowContextMenu,"row-dblclick":e._rowDblClick,"header-click":e._headerClick,"header-contextmenu":e._headerContextMenu,"sort-change":e._sortChange,"filter-change":e._filterChange,"current-change":e._currentChange,"header-dragend":e._headerDragend,"expand-change":e._expandChange}},[e.showSeletion?a("el-table-column",{attrs:{type:"selection",width:"55"}}):e._e(),e._t("default")],2)},ue=[],de=(a("20d6"),a("55dd"),a("b17e")),he={name:"FtTable",props:{data:{type:Array,default:function(){return[]}},size:String,width:[String,Number],height:[String,Number],maxHeight:[String,Number],fit:{type:Boolean,default:!0},stripe:Boolean,border:Boolean,rowKey:[String,Function],context:{},showHeader:{type:Boolean,default:!0},showSummary:Boolean,sumText:String,summaryMethod:Function,rowClassName:[String,Function],rowStyle:[Object,Function],cellClassName:[String,Function],cellStyle:[Object,Function],headerRowClassName:[String,Function],headerRowStyle:[Object,Function],headerCellClassName:[String,Function],headerCellStyle:[Object,Function],highlightCurrentRow:Boolean,currentRowKey:[String,Number],emptyText:String,expandRowKeys:Array,defaultExpandAll:Boolean,defaultSort:Object,tooltipEffect:String,spanMethod:Function,selectOnIndeterminate:{type:Boolean,default:!0},myStyle:{type:String,default:"width: 100%;"},showSeletion:{type:Boolean,default:!1},hasItem:{type:Function,default:function(){return function(){return!1}}},equalItem:{type:Function,default:function(){return function(){return!1}}}},data:function(){return{pickList:[]}},methods:{myToggleRowSelection:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.equalItem;this.pickList.length&&"function"===typeof t?this.pickList.forEach(function(a){e.data.forEach(function(s,i){t(s,a)&&e.$nextTick(function(){e.$refs.myTable.toggleRowSelection(e.data[i])})})}):this.clearSelection()},getPickedItems:function(){return this.pickList},clearPickedItems:function(){this.pickList=[]},clearSelection:function(){this.$refs.myTable.clearSelection()},toggleRowSelection:function(e,t){this.$refs.myTable.toggleRowSelection(e,t)},toggleAllSelection:function(){this.$refs.myTable.toggleAllSelection()},toggleRowExpansion:function(e,t){this.$refs.myTable.toggleRowExpansion(e,t)},setCurrentRow:function(e){this.$refs.myTable.setCurrentRow(e)},clearSort:function(){this.$refs.myTable.clearSort()},clearFilter:function(){this.$refs.myTable.clearFilter()},doLayout:function(){this.$refs.myTable.doLayout()},sort:function(e,t){this.$refs.myTable.sort(e,t)},_pickChange:function(e,t){var a=this;if(t){var s=this._findIndexInPickList(t);s<0?this._pushIntoPickList(t):this.pickList.splice(s,1),this.$emit("select",e,t)}else e.length?e.forEach(function(e){a._findIndexInPickList(e)<0&&a._pushIntoPickList(e)}):this.data.forEach(function(e){var t=a._findIndexInPickList(e);t>=0&&a.pickList.splice(t,1)}),this.$emit("select-all",e,t)},_pushIntoPickList:function(e){var t=de.clone(e);this.pickList.push(t)},_findIndexInPickList:function(e){return this.pickList.findIndex(this.hasItem(e))},_selectionChange:function(e){this.$emit("selection-change",e)},_cellMouseEnter:function(e,t,a,s){this.$emit("cell-mouse-enter",e,t,a,s)},_cellMouseLeave:function(e,t,a,s){this.$emit("cell-mouse-leave",e,t,a,s)},_cellClick:function(e,t,a,s){this.$emit("cell-click",e,t,a,s)},_cellDblClick:function(e,t,a,s){this.$emit("cell-dblclick",e,t,a,s)},_rowClick:function(e,t,a){this.$emit("row-click",e,t,a)},_rowContextMenu:function(e,t){this.$emit("row-contextmenu",e,t)},_rowDblClick:function(e,t){this.$emit("row-dblclick",e,t)},_headerClick:function(e,t){this.$emit("header-click",e,t)},_headerContextMenu:function(e,t){this.$emit("header-contextmenu",e,t)},_sortChange:function(e){this.$emit("sort-change",e)},_filterChange:function(e){this.$emit("filter-change",e)},_currentChange:function(e,t){this.$emit("current-change",e,t)},_headerDragend:function(e,t,a,s){this.$emit("header-dragend",e,t,a,s)},_expandChange:function(e,t){this.$emit("expand-change",e,t)}},watch:{data:function(e,t){e!==t&&(console.log("数据发生变化了"),this.myToggleRowSelection())},pickList:function(e){this.$emit("pickListChange",e)}}},me=he,pe=(a("ed12"),Object(l["a"])(me,ce,ue,!1,null,"5779b2c6",null));pe.options.__file="ft-table.vue";var fe=pe.exports,ve={name:"tagList",components:{FtTable:fe},data:function(){return{total:0,screen:!0,dataList:[],searchList:B,showSearchData:{},searchData:{page:1,pageSize:10},pickedCount:0}},methods:{showScreen:function(){this.screen=!this.screen},search:function(){var e=new Date(this.showSearchData.createTimeMax).getTime(),t=new Date(this.showSearchData.createTimeMin).getTime();return e&&t&&e<t?this.$message.error("创建开始时间不能大于结束时间"):(this.$refs.myTable.clearPickedItems(),this.showSearchData.page=1,this.searchData=Object(f["a"])({},JSON.parse(JSON.stringify(this.showSearchData)),{pageSize:this.searchData.pageSize}),this.getList(),"")},getList:function(){var e=this;this.$loading("加载中..."),this.$get("/crm/label/list.json",this.searchData).then(function(t){var a=t.data.object.list;e.dataList=a,e.total=t.data.object.paging.total,a.length<=0&&1!==e.searchData.page&&(e.searchData.page=1,e.getList())}).finally(function(){e.$loading().close()})},resetSearchData:function(){var e=this;this.searchData={page:1,pageSize:this.searchData.pageSize},this.searchList.forEach(function(t){"select"===t.type?e.$set(e.showSearchData,t.key,t.list.length&&t.list[0].value||"0"):"input"===t.type?e.$set(e.showSearchData,t.key,""):(e.$set(e.showSearchData,"".concat(t.key,"Min"),""),e.$set(e.showSearchData,"".concat(t.key,"Max"),""))})},clearSearch:function(){this.resetSearchData(),this.search()},clear:function(e){this.showSearchData["".concat(this.searchList[e].key,"Min")]="",this.showSearchData["".concat(this.searchList[e].key,"Max")]=""},addNew:function(){this.$router.push("/tag/detail")},lookLabel:function(e){this.$router.push("/tag/detail?id=".concat(e||"123"))},handleCommand:function(e){var t=this.returnLabelIds();"stop"===e?this.changeLabel(t,2):"delete"===e?this.deleteLabel(t):"activate"===e&&this.changeLabel(t,1)},returnLabelIds:function(){var e="",t=this.$refs.myTable.getPickedItems();return t.forEach(function(t){e+="".concat(t.labelId,",")}),e=e.substring(0,e.length-1),e},changeLabel:function(e,t){var a=this;if(!e)return this.$message.error("请选择内容");e="".concat(e);var s=e.indexOf(",");return this.$confirm("确定要".concat(1===t?"激活":"停用","这").concat(s>0?"些":"条","规则吗?")).then(function(){var s={labelStatus:t,labelIds:e};a.$post("/crm/label/updateStatus.json",s).then(function(){a.$message.success("操作成功"),a.$refs.myTable.clearPickedItems(),a.getList()})}),""},deleteLabel:function(e){var t=this;if(!e)return this.$message.error("请选择内容");e="".concat(e);var a=e.indexOf(",");return this.$confirm("确定要删除这".concat(a>0?"些":"条","规则吗?")).then(function(){t.$get("/crm/label/delete.json",{labelIds:e}).then(function(){t.$message.success("操作成功"),t.$refs.myTable.clearPickedItems(),t.getList()})}).catch(function(e){return console.log(e)}),""},selectChange:function(e){"标签大类"===e.name&&"1"===this.showSearchData.labelPartition&&(this.showSearchData.labelGroupId="0")},pageChange:function(e){this.searchData.page=e,this.getList()},pageSizeChange:function(e){this.searchData.pageSize=e,this.getList()},returnDate:function(e){return te.returnDate(e,"hour")},hasItem:function(e){return function(t){return t.labelId===e.labelId}},equalItem:function(e,t){return e.labelId===t.labelId},pickListChange:function(e){this.pickedCount=e.length||0},getTagGroupList:function(){var e=this;this.$get("/crm/label/group/list.json").then(function(t){e.searchList[1].list=t.data.object,e.searchList[1].list.unshift({labelGroupId:"0",labelGroupName:"全部"})})}},mounted:function(){this.resetSearchData(),this.getTagGroupList(),this.search()}},be=ve,ge=(a("11b1"),Object(l["a"])(be,re,oe,!1,null,"73cb35b6",null));ge.options.__file="TagList.vue";var ye=ge.exports,_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"header"},[e._v("\n        平台用户列表\n    ")]),a("div",{staticClass:"content"},[a("div",{staticClass:"item-title"},[a("span",[e._v("筛选")]),a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.search()}}},[e._v("查询结果")])],1)]),a("el-input",{attrs:{size:"small",placeholder:"用户编码/姓名/微信号/手机号"},nativeOn:{keyup:function(t){if(!("button"in t)&&13!==t.keyCode)return null;e.search()}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),e._m(0),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.dataList,"tooltip-effect":"dark",border:""}},[a("el-table-column",{attrs:{prop:"userId",label:"用户编码"}}),a("el-table-column",{attrs:{prop:"trueName",label:"姓名"}}),a("el-table-column",{attrs:{prop:"mobile",label:"手机号"}}),a("el-table-column",{attrs:{prop:"wechatId",label:"微信号"}}),a("el-table-column",{attrs:{prop:"country",label:"国家"}}),a("el-table-column",{attrs:{prop:"serviceUnitAmount",label:"服务商品客单价"}}),a("el-table-column",{attrs:{prop:"commonUnitAmount",label:"实物商品客单价"}}),a("el-table-column",{attrs:{prop:"registerChannel",label:"注册渠道"}}),a("el-table-column",{attrs:{prop:"userOrigin",label:"用户来源"}}),a("el-table-column",{attrs:{label:"注册时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.returnDate(t.row.createTime))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"middle"},on:{click:function(a){e.checkInfo(t.row.userId)}}},[e._v("查看")])]}}])})],1),a("div",{staticClass:"page-box"},[a("el-pagination",{staticClass:"ft-pagination",attrs:{"current-page":e.page,"page-sizes":[10,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.pageSizeChange,"current-change":e.pageChange}})],1)],1)])},ke=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title item-title-level-2"},[a("span",[e._v("数据列表")])])}],Ce={name:"userInfo",props:[],data:function(){return{searchText:"",currentSearchText:"",page:1,pageSize:10,total:0,dataList:[]}},created:function(){this.getList()},methods:{search:function(){this.currentSearchText=this.searchText,this.page=1,this.getList()},getList:function(){var e=this;this.$loading("加载中..."),this.$get("/statistic/user/list.json",{keyword:this.currentSearchText,page:this.page,pageSize:this.pageSize}).then(function(t){e.dataList=t.data.object.list,e.total=t.data.object.paging.total,e.dataList.length||1===e.page||(e.page=1,e.getList()),e.$loading().close()}).catch(function(){return e.$loading().close()})},pageChange:function(e){this.page=e,this.getList()},pageSizeChange:function(e){this.pageSize=e,this.getList()},checkInfo:function(e){this.$router.push("/userInfo?userId=".concat(e))},returnDate:function(e){return te.returnDate(e,"hour")}},mounted:function(){}},we=Ce,Se=(a("6f68"),Object(l["a"])(we,_e,ke,!1,null,"1501784a",null));Se.options.__file="CrmUserList.vue";var xe=Se.exports,$e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"header"},[e._v("\n        用户详情\n        "),a("el-button",{staticClass:"right-btn",on:{click:function(t){e.goBack()}}},[e._v("返回")])],1),a("div",{staticClass:"content"},[e._m(0),a("div",{staticClass:"item-content"},[a("el-row",[a("el-col",{attrs:{span:6}},[e._v("\n                     \n                    "),a("div",{staticClass:"avatar-info"},[a("img",{staticClass:"avatar-img",attrs:{src:e.basicInfo.avatar}}),a("div",{staticClass:"avatar-text"},[e._v(e._s(e.basicInfo.userId))])])]),a("el-col",{attrs:{span:9}},[a("div",{staticClass:"item-label"},[e._v("姓名")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.trueName))])]),a("el-col",{attrs:{span:9}},[a("div",{staticClass:"item-label"},[e._v("手机号")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.mobile))])])],1),a("el-row",[a("el-col",{attrs:{span:9,offset:6}},[a("div",{staticClass:"item-label"},[e._v("注册时间")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.createTime))])]),a("el-col",{attrs:{span:9}},[a("div",{staticClass:"item-label"},[e._v("微信号")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.wechatId))])])],1),a("el-row",[a("el-col",{attrs:{span:9,offset:6}},[a("div",{staticClass:"item-label"},[e._v("注册渠道")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.registerChannel))])]),a("el-col",{attrs:{span:9}},[a("div",{staticClass:"item-label"},[e._v("裂变等级")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.fissionLevel))])])],1),a("el-row",[a("el-col",{attrs:{span:9,offset:6}},[a("div",{staticClass:"item-label"},[e._v("用户来源")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.userOrigin))])]),a("el-col",{attrs:{span:9}},[a("div",{staticClass:"item-label"},[e._v("上级用户编码")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.fromUserId))])])],1),a("el-row",[a("el-col",{attrs:{span:18,offset:6}},[a("div",{staticClass:"tag-chosen"},[a("div",{staticClass:"tag-chosen-label item-label"},[e._v("标签筛选")]),a("label-picker",{staticClass:"tag-chosen-field",attrs:{searchFunc:e.searchFunc,labels:e.basicInfo.labels,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0)},on:{pickLabel:e.pickLabel,deleteLabel:e.deleteLabel}})],1)])],1)],1),e._m(1),a("div",{staticClass:"item-content"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("年龄")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.age))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("职业")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.occupation))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("婚姻情况")]),a("div",{staticClass:"item-value"})]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("性别")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.gender))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("生育情况")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.parentalStatus))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("国家")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.country))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("宝宝生日")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.basicInfo.babyBirthday))])])],1)],1),e._m(2),a("div",{staticClass:"item-content"},[a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("身高")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.height))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("BMI")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.bmi))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("臀围")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.hipline))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("步数(日均)")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.steps))])])],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("体重")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.weight))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("腰围")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.waistline))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("腰臀比")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.whpercent))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("热量等级")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.hotLevel))])])],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("饮水等级")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.waterLevel))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"item-label"},[e._v("心率")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.heartRate))])])],1),a("div",{staticClass:"separator-line"}),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("腹直肌分离情况")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.rectusAbdominis))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("母乳比例")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.breastMilkLevel))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("盆底肌情况")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.pelvicFloorMuscle))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("身体情况")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.health))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("产褥期后盆底肌得分")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.pelvicFloorMuscleScore))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("减肥史")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.slimmin))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("分娩伤口情况")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.isWoundHealed))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("减肥效果史")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.result))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label"},[e._v("乳房不适情况")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.healthInfo.isExpansionBreast))])])],1)],1),e._m(3),a("div",{staticClass:"item-content"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("实物商品累计消费金额")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.commonGoodsPayAmount))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("累计饮食打卡次数")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.totalEatCheckinCount))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("服务商品累计消费金额")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.serviceGoodsPayAmount))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("累计运动打卡次数")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.totalTraingCheckinCount))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("累计服务商品订单数量")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.serviceGoodsCount))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("关注口袋减脂营")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.isFollowFitcamp))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("累计实物商品订单数量")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.commonGoodsCount))])]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("关注健康助利")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.isFollowHealth))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("实物商品客单价")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.commonGoodsUnitAmount))])])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"item-label item-label-long"},[e._v("服务商品客单价")]),a("div",{staticClass:"item-value"},[e._v(e._s(e.actionInfo.serviceGoodsUnitAmount))])])],1)],1)])])},Ie=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("账户信息")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("基础信息")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("健康信息")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("行为信息")])])}],Le=(a("28a5"),["parentalStatus","gender"]),Te=["rectusAbdominis","pelvicFloorMuscle","pelvicFloorMuscleScore","isWoundHealed","isExpansionBreast","campType","breastMilkLevel","slimmin","result","health"],De={gender:{F:"女",M:"男"},parentalStatus:{1:"已生育",2:"未生育"}},je={rectusAbdominis:{1:"0-2指",2:"2-4指",3:"超过4指",4:"不知道判断如何分离"},pelvicFloorMuscle:{1:"没有",2:"只在打喷嚏或运动时发⽣过漏尿",3:"有过1-2次这种情况",4:"⽐较严重"},pelvicFloorMuscleScore:{1:"80分以上",2:"60-80分",3:"60分以下",4:"没做筛查"},isWoundHealed:{1:"医⽣确认我恢复得很好",2:"伤⼝呈粉⾊，偶有疼痛",3:"动作幅度⼤时有撕裂感",4:"不清楚"},isExpansionBreast:{1:"是",2:"否"},breastMilkLevel:{1:"⾮⺟乳喂养",2:"⺟乳占宝宝饮食⽐例<50%",3:"⺟乳占宝宝饮食⽐例约为50%",4:"⺟乳占宝宝 饮食⽐例约为70%",5:"全母乳喂养"},slimmin:{1:"健身房运动锻炼减肥",2:"代餐减肥",3:"吃减肥药",4:"节⻝/哥本哈根/不吃脂肪等",5:"其他减肥⽅式",6:"⽆"},campType:{1:"减脂营",2:"辣妈营"},result:{1:"无效",2:"当时有效后来反弹",3:"效果满意没有反弹"},health:{1:"孕期",2:"产后(0-24个⽉月)",3:"其他"}},Pe={name:"userInfo",props:[],data:function(){return{basicInfo:{},healthInfo:{},actionInfo:{}}},created:function(){var e=this.$route.query.userId;this.getBasicInfo(e),this.getHealthInfo(e),this.getActionInfo(e)},methods:{getBasicInfo:function(e){var t=this;this.$get("/statistic/user/userInfo.json",{userId:e}).then(function(e){var a=e.data&&e.data.object||{};a.createTime=te.returnDate(a.createTime,"hour"),a.userBirthday=te.returnDate(a.userBirthday),a.babyBirthday=te.returnDate(a.babyBirthday),a.labels=a.labels||[],a.labels=a.labels.map(function(e){var t=!1;return 1===e.labelType&&(t=!0),Object(f["a"])({},e,{closable:t})}),Le.forEach(function(e){var t=[],s="".concat(a[e]||"").split(",");s.forEach(function(a){var s=De[e][a]||a;t.push(s)}),a[e]=t.join(",")}),t.basicInfo=a})},getHealthInfo:function(e){var t=this;this.$get("/statistic/user/userHealthInfo.json",{userId:e}).then(function(e){var a=e.data&&e.data.object||{};Te.forEach(function(e){var t=[],s="".concat(a[e]||"").split(",");s.forEach(function(a){var s=je[e][a]||a;t.push(s)}),a[e]=t.join(",")}),t.healthInfo=a})},getActionInfo:function(e){var t=this;this.$get("/statistic/user/userActionInfo.json",{userId:e}).then(function(e){var a=e.data&&e.data.object||{};a.isFollowFitcamp=t.isFollowWx(a.isFollowFitcamp),a.isFollowHotcamp=t.isFollowWx(a.isFollowHotcamp),a.isFollowFittime=t.isFollowWx(a.isFollowFittime),a.isFollowHealth=t.isFollowWx(a.isFollowHealth),a.isFollowFittimeShop=t.isFollowWx(a.isFollowFittimeShop),t.actionInfo=a})},isFollowWx:function(e){return 1===e?"是":"否"},searchFunc:function(e){var t={labelPartition:1,labelGroupId:0};return e&&(t.labelName=e),this.$get("/crm/label/search.json",t).then(function(e){var t=e.data.object;return t&&t.length?(t.forEach(function(e){e.closable=!0}),Promise.resolve(t)):Promise.resolve([])})},pickLabel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.basicInfo.labels;e.labelName&&t.indexOf(e)<0&&this.basicInfo.userId&&this.$post("/crm/label/addRelation.json",{userId:this.basicInfo.userId,labelId:e.labelId,relationType:1}).then(function(){t.push(e)})},deleteLabel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.labelId&&this.basicInfo.userId&&this.$confirm("确认要解除当前用户与 ".concat(t.labelName," 的关联关系吗？?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$loading("删除规则中...");var a=e.basicInfo.labels;e.$get("/crm/label/relation/user/unbind.json",{labelId:t.labelId,userId:e.basicInfo.userId}).then(function(){e.basicInfo.labels=a.filter(function(e){return e!==t}),e.$loading().close()})}).catch(function(){})},goBack:function(){this.$router.push("/crmUserList")}},mounted:function(){}},Ne=Pe,Me=(a("ce8a"),Object(l["a"])(Ne,$e,Ie,!1,null,"67f235d3",null));Me.options.__file="UserInfo.vue";var Ee=Me.exports,Re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[e._v("营销软文")]),a("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"ad"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-share"}),e._v(" 链接 ( "+e._s(e.ad.totle)+" )")]),a("search",{attrs:{search:e.ad,type:"ad",addButtonName:"新建链接"}})],1),a("el-tab-pane",{attrs:{name:"picture"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-picture"}),e._v(" 图片 ( "+e._s(e.picture.totle)+" )")]),a("search",{attrs:{search:e.picture,type:"picture",addButtonName:"上传图片"}})],1),a("el-tab-pane",{attrs:{name:"video"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-view"}),e._v(" 视频 ( "+e._s(e.video.totle)+" )")]),a("search",{attrs:{search:e.video,type:"video",addButtonName:"添加视频"}})],1)],1)],1)},ze=[],Fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row"),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{placeholder:"请按标题关键字搜索","prefix-icon":"el-icon-search"},model:{value:e.search.input,callback:function(t){e.$set(e.search,"input",t)},expression:"search.input"}})],1),a("el-col",{attrs:{span:18}},[e._v("\n            使用状态\n            "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.search.select,callback:function(t){e.$set(e.search,"select",t)},expression:"search.select"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),a("el-row",[a("el-col",{staticClass:"content-text-center",attrs:{span:4}},[e._v("\n            内容标签：\n        ")]),a("el-col",{attrs:{span:20}},[a("tagList",{attrs:{labelList:e.labels,labelType:"0"}})],1)],1),a("el-row",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.searchData(1)}}},[e._v("查询")]),a("el-button",{attrs:{type:"danger"},on:{click:e.add}},[e._v(e._s(e.addButtonName))])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),a("el-table-column",{attrs:{label:"内容ID",prop:"resourceId"}}),a("el-table-column",{attrs:{label:"标题",prop:"title"}}),a("el-table-column",{staticClass:"hand",attrs:{label:"内容",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.resourceType||4===t.row.resourceType?[a("div",{staticClass:"link hand",on:{click:function(a){e.showPreview(t.row.linkUrl+"&preview=1","link")}}},[e._v(e._s(e.filterLink(t.row.linkUrl)))])]:e._e(),2===t.row.resourceType?[a("video",{staticClass:"table-video hand",attrs:{src:t.row.vedioUrl},on:{click:function(a){e.showPreview(t.row.vedioUrl,"video")}}})]:e._e(),3===t.row.resourceType?[a("img",{staticClass:"table-img hand",attrs:{src:t.row.imageUrl},on:{click:function(a){e.showPreview(t.row.imageUrl,"image")}}})]:e._e()]}}])}),"video"===e.type?a("el-table-column",{attrs:{label:"时长",prop:"vedioLength"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.filterTime(t.row.vedioLength))+"\n            ")]}}])}):e._e(),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.filterDate(t.row.createTime))+"\n            ")]}}])}),a("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.filterDate(t.row.lastUpdateTime))+"\n            ")]}}])}),a("el-table-column",{attrs:{label:"使用状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(0==t.row.isUsed?"未使用":"已使用")+"\n            ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[0!==t.row.isUsed?a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleView(t.row.resourceId)}}},[e._v("查看")]):e._e(),0===t.row.isUsed?a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleEdit(t.row.resourceId)}}},[e._v("编辑")]):e._e(),0===t.row.isUsed?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handleDelete(t.row.resourceId)}}},[e._v("删除")]):e._e()]}}])})],1),a("el-row",{staticClass:"footer-pagination"},[a("el-pagination",{attrs:{"current-page":e.page.current,layout:"total, prev, pager, next, jumper",total:e.page.total},on:{"current-change":e.handleCurrentChange}})],1),a("preview",{attrs:{src:e.src,visible:e.visible,srcType:e.srcType},on:{hidden:e.hiddenPreview}})],1)},Be=[];a("ee1d"),a("456d"),a("3b2b");function Ue(e){return"00".concat(e).substr(e.length)}function Oe(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,"".concat(e.getFullYear()).substr(4-RegExp.$1.length)));var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};return Object.keys(a).forEach(function(e){if(new RegExp("(".concat(e,")")).test(t)){var s="".concat(a[e]);t=t.replace(RegExp.$1,1===RegExp.$1.length?s:Ue(s))}}),t}var qe={formatDate:Oe},Ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("label-picker",{staticClass:"tag-chosen-field",attrs:{searchFunc:e.searchFunc,labels:e.labelList,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0)},on:{pickLabel:e.pickLabel,deleteLabel:e.deleteLabel}})],1)},He=[],Ge={name:"tagList",props:{labelList:{required:!0,type:Array},labelType:{default:function(){return 1}}},methods:{searchFunc:function(e){var t={labelPartitions:"2,3",labelType:Number(this.labelType),labelGroupId:0};return e&&(t.labelName=e),this.$get("/crm/label/search.json",t).then(function(e){var t=e.data.object;return t&&t.length?(t.forEach(function(e){e.closable=!0}),t=t.filter(function(e){return 2===e.labelPartition||3===e.labelPartition}),Promise.resolve(t)):Promise.resolve([])})},pickLabel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.labelName&&this.labelList.findIndex(function(t){return t.labelId===e.labelId})<0&&this.labelList.push(e)},deleteLabel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.labelList.indexOf(e);t>-1&&this.labelList.splice(t,1)}}},Qe=Ge,Ve=(a("1408"),Object(l["a"])(Qe,Ae,He,!1,null,"8bda5178",null));Ve.options.__file="tagList.vue";var Ke=Ve.exports,We=[{value:-1,label:"全部"},{value:1,label:"已使用"},{value:0,label:"未使用"}],Je={name:"adListSearch",components:{tagList:Ke},props:{search:{validator:function(e){return void 0!==e.searchValue&&void 0!==e.select}},addButtonName:{type:String,required:!0},type:{validator:function(e){return["ad","picture","video"].indexOf(e)>-1}}},data:function(){return{options:We,labels:[],tableData:[],page:{current:1,total:0},src:"",visible:!1,srcType:"link"}},created:function(){this.searchData()},methods:{searchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a={resourceType:this.search.type,title:this.search.input,isUsed:this.search.select,labels:this.labels.map(function(e){return e.labelId}).join(","),page:t,pageSize:10};this.$loading({text:"获取数据中..."}),this.$get("/resources/findResourcesByType.json",a).then(function(t){0!==t.data.object.list.length||1===t.data.object.paging.page?(e.$loading().close(),e.tableData=t.data.object.list,e.page.current=t.data.object.paging.page,e.search.totle=t.data.object.paging.total,e.page.total=t.data.object.paging.total):e.searchData(1)})},add:function(){this.$router.push("/marketing/".concat(this.type,"/edit"))},handleCurrentChange:function(e){this.searchData(e)},handleView:function(e){this.$router.push("/marketing/".concat(this.type,"/edit?action=view&id=").concat(e))},handleEdit:function(e){this.$router.push("/marketing/".concat(this.type,"/edit?action=edit&id=").concat(e))},handleDelete:function(e){var t=this;this.$confirm("确定要这条数据吗?").then(function(){t.$loading({text:"删除数据中..."});var a={resourceId:e};t.$post("/resources/deleteResourcesById.json",a).then(function(){t.$loading().close(),t.searchData(t.page.current)})})},hiddenPreview:function(){this.src="",this.visible=!1},showPreview:function(e,t){this.src=e,this.srcType=t,this.visible=!0},filterLink:function(e){var t="";return e&&e.slice&&(t="".concat(e.slice(0,-6),"******")),t},filterTime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t="";if(e=Number(e),!Number.isNaN(e)){var a=Math.floor(e/60),s=Math.ceil(e%60);t="".concat(a," ： ").concat(s>10?s:"0".concat(s)," ")}return t},filterDate:function(e){var t="";return e>0&&(t=qe.formatDate(new Date(e),"yyyy-MM-dd hh:mm:ss")),t}}},Ze=Je,Ye=(a("b2c5"),Object(l["a"])(Ze,Fe,Be,!1,null,"54e4b998",null));Ye.options.__file="search.vue";var Xe=Ye.exports,et={name:"ad",components:{search:Xe},created:function(){this.changeTab()},data:function(){return{activeName:"ad",ad:{type:1,searchValue:"",select:-1,totle:0},picture:{type:3,searchValue:"",select:-1,totle:0},video:{type:2,searchValue:"",select:-1,totle:0}}},methods:{changeTab:function(){this.$route.query.type&&(console.log(this.$route.query.type),this.activeName=this.$route.query.type)}}},tt=et,at=(a("b826"),Object(l["a"])(tt,Re,ze,!1,null,"03ca623d",null));at.options.__file="list.vue";var st=at.exports,it=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[e._v(e._s(e.title)+" "),a("el-button",{staticClass:"back-Btn",attrs:{size:"small",type:"primary",icon:"el-icon-back"},on:{click:e.back}},[e._v("返回")])],1),a("el-form",{attrs:{"label-position":"left","label-width":"80px",model:e.form}},[a("titleInput",{attrs:{form:e.form,edit:!e.edit}}),a("el-form-item",{attrs:{required:"",label:"详情"}},[a("div",{ref:"editor",staticStyle:{"text-align":"left"}})]),a("el-form-item",{attrs:{required:"",label:"封面"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/uploadImage.html?action=uploadImage","show-file-list":!1,disabled:!e.edit,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError}},[a("div",{attrs:{slot:"tip"},slot:"tip"},[a("div",{staticClass:"error-text"},[e._v("图片比例为1:1.")]),a("div",[e._v("建议在上传图片之前，对大于300kb的图片进行压缩。压缩图片网址：\n                        "),a("a",{staticClass:"blue-text",attrs:{href:"https://tinypng.com/",target:"_blank"}},[e._v("https://tinypng.com/")])])]),this.form.picture?a("img",{staticClass:"avatar",attrs:{src:this.form.picture}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("el-form-item",{attrs:{label:"内容标签"}},[e.edit?a("tagList",{attrs:{labelList:this.form.tagList}}):a("ft-labels",{attrs:{labels:this.form.tagList}})],1),e.edit?a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")])],1):e._e()],1)],1)},nt=[],lt=a("1a0b"),rt=a.n(lt),ot=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form-item",{attrs:{required:"",label:"标题"}},[a("el-input",{staticClass:"title-input",attrs:{disabled:!!e.edit},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}},[a("div",{attrs:{slot:"append"},slot:"append"},[a("span",{class:{"error-text":this.form.title.length>30}},[e._v(e._s(this.form.title.length))]),e._v("／30")])]),this.form.title.length>30?a("div",{staticClass:"error-text"},[e._v("请正确输入标题，限制30字符不区分中英文。")]):e._e()],1)},ct=[],ut={name:"titleInput",props:{form:{validator:function(e){return void 0!==e.title}},edit:{}}},dt=ut,ht=(a("88b2"),Object(l["a"])(dt,ot,ct,!1,null,"598c7f18",null));ht.options.__file="titleInput.vue";var mt=ht.exports,pt={name:"pictureEdit",components:{tagList:Ke,titleInput:mt},data:function(){return{title:"新建链接",edit:!0,id:0,form:this.createEmptyData()}},mounted:function(){var e=this,t=new rt.a(this.$refs.editor);this.editor=t,t.customConfig.onchange=function(t){e.form.linkContent=t},t.customConfig.customUploadImg=function(t,a){var s=new FormData;s.append("file",t[0]),e.$loading("上传图片中。。。"),e.$post("/uploadImage.html?action=uploadImage",s).then(function(t){e.$loading().close(),a(t.data.imageUrl)})},t.customConfig.zIndex=100,t.create(),this.checkPageStatus(),t.$textElem.attr("contenteditable",this.edit)},methods:{checkPageStatus:function(){this.$route.query.id?(this.edit="edit"===this.$route.query.action,this.title=this.edit?"编辑链接":"查看链接",this.id=this.$route.query.id,this.findDataById(this.id)):(this.title="新建链接",this.edit=!0,this.id=0,this.resetData())},createEmptyData:function(){return{picture:"",linkContent:"",title:"",tagList:[]}},resetData:function(){this.form=this.createEmptyData()},findDataById:function(e){var t=this;return this.$loading({text:"获取数据中..."}),this.$get("/resources/findResourcesById.json",{resourceId:e}).then(function(e){if(t.$loading().close(),200===e.data.retcode){var a=e.data.object;t.form.title=a.resource.title,t.form.linkContent=a.resource.linkContent,t.editor&&t.editor.txt.html(a.resource.linkContent),t.form.picture=a.resource.imageUrl,a.labels.forEach(function(e){e.closable=!0}),t.form.tagList=a.labels}else t.form.picture="",t.$alert("获取数据失败");return Promise.resolve(e)})},beforeUpload:function(e){return/(.jpg|.png|.jpeg)$/.test(e.name)?!(e.size>307200)||(this.$alert("图片大小必须在300kb以内，上传图片大小为：".concat(Number(e.size/1024).toFixed(2),"kb")),!1):(this.$alert("文件格式必须是jpg,png或jpeg"),!1)},uploadSuccess:function(e){200===e.retcode&&e.imageUrl?(this.$message.success("上传成功"),this.form.picture=e.imageUrl||""):this.$alert("上传失败")},uploadError:function(){this.$alert("上传封面图片失败")},deletePicture:function(){var e=this;this.$confirm("是否删除封面图片？").then(function(){e.form.picture=""})},submit:function(){var e=this,t={resourceType:1,title:this.form.title,linkContent:this.form.linkContent,labels:this.form.tagList.map(function(e){return e.labelId}).join(","),imageUrl:this.form.picture};this.id&&(t.resourceId=this.id),t.title.length<1?this.$alert("请输入链接标题"):t.title.length>30?this.$alert("链接标题的长度超过了30,请适当减少"):String(t.linkContent).trim().length<1?this.$alert("请编辑详情内容"):t.imageUrl?(this.$loading({text:"保存数据中..."}),this.$post("/resources/addOrModifyResource.json",t).then(function(){e.$loading().close(),e.$alert("保存成功").then(function(){e.back()})}).finally(function(){e.$loading().close()})):this.$alert("必须上传封面才能保存")},back:function(){this.$router.push("/marketing/list?type=ad")}}},ft=pt,vt=(a("95f7"),Object(l["a"])(ft,it,nt,!1,null,"4333f85a",null));vt.options.__file="ad.vue";var bt=vt.exports,gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[e._v(e._s(e.title)+" "),a("el-button",{staticClass:"back-Btn",attrs:{size:"small",type:"primary",icon:"el-icon-back"},on:{click:e.back}},[e._v("返回")])],1),a("el-form",{attrs:{"label-position":"left","label-width":"80px",model:e.form}},[e.edit?a("el-form-item",{attrs:{required:"",label:"上传"}},[a("el-upload",{attrs:{action:"/uploadImage.html?action=uploadImage","file-list":this.form.pictureList,limit:1,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError,disabled:Boolean(e.edit&&this.form.pictureList[0]),"show-file-list":!1,"list-type":"picture"}},[a("el-button",{attrs:{size:"small",disabled:Boolean(e.edit&&this.form.pictureList[0]),type:"primary"}},[e._v("点击上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("上传图片不能超过5M")])],1),this.form.pictureList[0]?[a("div",{staticClass:"picture"},[a("div",{staticClass:"picture"},[a("img",{staticClass:"picture-max",attrs:{src:this.form.pictureList[0].url,alt:""}})]),a("div",{staticClass:"picture2"},[a("el-button",{staticClass:"picture-delete",attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:e.deletePicture}})],1)])]:e._e()],2):a("el-form-item",{attrs:{required:"",label:"图片"}},[this.form.pictureList[0]?[a("div",{staticClass:"picture"},[a("div",{staticClass:"picture"},[a("img",{staticClass:"picture-max",attrs:{src:this.form.pictureList[0].url,alt:""}})])])]:e._e()],2),a("titleInput",{attrs:{form:e.form,edit:!e.edit}}),a("el-form-item",{attrs:{label:"内容标签"}},[e.edit?a("tagList",{attrs:{labelList:this.form.tagList}}):a("ft-labels",{attrs:{labels:this.form.tagList}})],1),e.edit?a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")])],1):e._e()],1)],1)},yt=[],_t={name:"pictureEdit",components:{tagList:Ke,titleInput:mt},data:function(){return{title:"上传图片",edit:!0,id:0,form:this.createEmptyData()}},created:function(){this.checkPageStatus()},methods:{checkPageStatus:function(){this.$route.query.id?(this.edit="edit"===this.$route.query.action,this.title=this.edit?"编辑图片":"查看图片",this.id=this.$route.query.id,this.findDataById(this.id)):(this.title="上传图片",this.edit=!0,this.id=0,this.resetData())},createEmptyData:function(){return{picture:"",pictureList:[],title:"",tagList:[]}},resetData:function(){this.form=this.createEmptyData()},findDataById:function(e){var t=this;return this.$loading({text:"获取数据中..."}),this.$get("/resources/findResourcesById.json",{resourceId:e}).then(function(e){if(t.$loading().close(),200===e.data.retcode){var a=e.data.object;t.form.title=a.resource.title,t.form.pictureList=[{url:a.resource.imageUrl}],a.labels.forEach(function(e){e.closable=!0}),t.form.tagList=a.labels}else t.form.pictureList=[],t.$alert("获取数据失败");return Promise.resolve(e)})},beforeUpload:function(e){return 1!==this.form.pictureList.length&&(/(.jpg|.png|.jpeg)$/.test(e.name)?!(e.size>5242880)||(this.$alert("图片大小必须在5M以内，上传图片大小为：".concat(Number(e.size/1048576).toFixed(2),"M")),!1):(this.$alert("文件格式必须是jpg,png或jpeg"),!1))},uploadSuccess:function(e){200===e.retcode&&e.imageUrl?(this.$message.success("上传成功"),this.form.pictureList=[{url:e.imageUrl}]):this.$alert("上传失败")},uploadError:function(){this.$alert("上传图片失败")},deletePicture:function(){var e=this;this.$confirm("是否删除图片？").then(function(){e.form.pictureList=[]})},submit:function(){var e=this,t={resourceType:3,title:this.form.title,labels:this.form.tagList.map(function(e){return e.labelId}).join(","),imageUrl:this.form.pictureList[0]&&this.form.pictureList[0].url};this.id&&(t.resourceId=this.id),t.title.length<1?this.$alert("请输入图片标题"):t.title.length>30?this.$alert("图片标题的长度超过了30,请适当减少"):t.imageUrl?(this.$loading({text:"保存数据中..."}),this.$post("/resources/addOrModifyResource.json",t).then(function(){e.$loading().close(),e.$alert("保存成功").then(function(){e.back()})}).finally(function(){e.$loading().close()})):this.$alert("必须上传图片才能保存")},back:function(){this.$router.push("/marketing/list?type=picture")}}},kt=_t,Ct=(a("eae3"),Object(l["a"])(kt,gt,yt,!1,null,"17f070ba",null));Ct.options.__file="picture.vue";var wt=Ct.exports,St=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[e._v(e._s(e.title)+" "),a("el-button",{staticClass:"back-Btn",attrs:{size:"small",type:"primary",icon:"el-icon-back"},on:{click:e.back}},[e._v("返回")])],1),a("el-form",{attrs:{"label-position":"left","label-width":"90px",model:e.form}},[e.edit?a("el-form-item",{attrs:{required:"",label:"上传视频"}},[a("el-upload",{attrs:{action:"/uploadFile.html?action=uploadFile","file-list":this.form.videoList,limit:1,disabled:Boolean(e.edit&&this.form.videoList[0]),"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError,"show-file-list":!1,"list-type":"text"}},[a("el-button",{attrs:{size:"small",disabled:Boolean(e.edit&&this.form.videoList[0]),type:"primary"}},[e._v("点击上传")]),a("div",{attrs:{slot:"tip"},slot:"tip"},[a("div",[e._v("视频时长不能超过5分钟，大小不能超过25MB，仅支持mp4格式")]),a("div",[e._v("建议在上传视频之前进行压缩。压缩视频网址： "),a("a",{staticClass:"blue-text",attrs:{href:"https://www.shipinyasuo.com",target:"_blank"}},[e._v("www.shipinyasuo.com")])])])],1),this.form.videoList[0]?[a("div",{staticClass:"video"},[a("div",{staticClass:"video"},[a("video",{ref:"video",staticClass:"video-max",attrs:{controls:"",preload:"auto",src:this.form.videoList[0].url,alt:""},on:{loadedmetadata:e.loadedMetaData}})]),a("div",{staticClass:"video-btn"},[a("el-button",{staticClass:"video-delete",attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:e.deleteVideo}})],1)])]:e._e()],2):a("el-form-item",{attrs:{required:"",label:"视频"}},[this.form.videoList[0]?[a("div",{staticClass:"video"},[a("div",{staticClass:"video"},[a("video",{staticClass:"video-max",attrs:{controls:"",preload:"auto",src:this.form.videoList[0].url,alt:""}})])])]:e._e()],2),a("titleInput",{attrs:{form:e.form,edit:!e.edit}}),a("el-form-item",{attrs:{label:"内容标签"}},[e.edit?a("tagList",{attrs:{labelList:this.form.tagList}}):a("ft-labels",{attrs:{labels:this.form.tagList}})],1),e.edit?a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")])],1):e._e()],1)],1)},xt=[],$t=26214400,It={name:"videoEdit",components:{tagList:Ke,titleInput:mt},data:function(){return{title:"",form:this.createEmptyData()}},created:function(){this.checkPageStatus()},methods:{checkPageStatus:function(){this.$route.query.id?(this.edit="edit"===this.$route.query.action,this.title=this.edit?"编辑视频":"查看视频",this.id=this.$route.query.id,this.findDataById(this.id)):(this.title="添加视频",this.edit=!0,this.id=0,this.resetData())},createEmptyData:function(){return{video:"",videoList:[],title:"",tagList:[]}},resetData:function(){this.form=this.createEmptyData()},findDataById:function(e){var t=this;return this.$loading({text:"获取数据中..."}),this.$get("/resources/findResourcesById.json",{resourceId:e}).then(function(e){if(200===e.data.retcode){var a=e.data.object;t.form.title=a.resource.title,t.form.duration=Number(a.resource.vedioLength),t.form.videoList=[{url:a.resource.vedioUrl}],a.labels.forEach(function(e){e.closable=!0}),t.form.tagList=a.labels}else t.form.pictureList=[],t.$alert("获取数据失败");return Promise.resolve(e)}).finally(function(){t.$loading().close()})},beforeUpload:function(e){return 1!==this.form.videoList.length&&(/.mp4$/.test(e.name)?!(e.size>$t)||(this.$alert("文件大小必须小于25M"),!1):(this.$alert("文件格式必须是mp4"),!1))},uploadSuccess:function(e){200===e.retcode&&e.imageUrl?(this.$message.success("上传成功"),this.form.duration=void 0,this.form.videoList=[{url:e.imageUrl}]):this.$alert("上传失败")},uploadError:function(){this.$alert("上传视频失败")},deleteVideo:function(){var e=this;this.$confirm("是否删除视频？").then(function(){e.form.videoList=[]})},submit:function(){var e=this,t={resourceType:2,title:this.form.title,labels:this.form.tagList.map(function(e){return e.labelId}).join(","),vedioUrl:this.form.videoList[0]&&this.form.videoList[0].url,vedioLength:Math.ceil(this.form.duration)};this.id&&(t.resourceId=this.id),t.title.length<1?this.$alert("请输入视频标题"):t.title.length>30?this.$alert("视频标题的长度超过了30,请适当减少"):t.vedioUrl?void 0!==t.vedioLength?t.vedioLength>300?this.$alert("视频时长必须小于5分钟"):(this.$loading({text:"保存数据中..."}),this.$post("/resources/addOrModifyResource.json",t).then(function(){e.$loading().close(),e.$alert("保存成功").then(function(){e.back()})}).finally(function(){e.$loading().close()})):this.$alert("未获取到视频时长"):this.$alert("必须上传视频才能保存")},back:function(){this.$router.push("/marketing/list?type=video")},loadedMetaData:function(){console.log("视屏时长",this.$refs.video.duration,"秒"),this.form.duration=this.$refs.video.duration}}},Lt=It,Tt=(a("db6f"),Object(l["a"])(Lt,St,xt,!1,null,"4f0a8dbe",null));Tt.options.__file="video.vue";var Dt=Tt.exports,jt=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Pt=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("div",{staticClass:"warning-box"},[e._v("\n        小哥哥小姐姐们，不要慌，从上面的菜单选择相应的功能\n    ")])])}],Nt={name:"Home",props:[],methods:{}},Mt=Nt,Et=(a("e31a"),Object(l["a"])(Mt,jt,Pt,!1,null,"1cad231b",null));Et.options.__file="Home.vue";var Rt=Et.exports,zt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header-wrapper"},[a("div",{staticClass:"header"},[a("el-row",[a("el-col",{attrs:{span:2}},[a("span",[e._v("群发管理")])]),a("el-col",{attrs:{span:22}},[a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"danger"},on:{click:e.newGroupMsg}},[e._v("新建群发")])],1)])],1)],1),a("div",{staticClass:"options"},[a("el-form",{staticClass:"options-form",attrs:{inline:!0,model:e.searchParams}},[a("el-form-item",{staticClass:"option-item"},[a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请按标题关键字搜索"},model:{value:e.searchParams.taskTitle,callback:function(t){e.$set(e.searchParams,"taskTitle",t)},expression:"searchParams.taskTitle"}})],1),a("el-form-item",{staticClass:"option-item",attrs:{label:"发送时间："}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"发送时间"},model:{value:e.searchParams.taskSendTimeStart,callback:function(t){e.$set(e.searchParams,"taskSendTimeStart",t)},expression:"searchParams.taskSendTimeStart"}})],1),a("el-form-item",{staticClass:"option-item",attrs:{label:"至"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"结束时间"},model:{value:e.searchParams.taskSendTimeEnd,callback:function(t){e.$set(e.searchParams,"taskSendTimeEnd",t)},expression:"searchParams.taskSendTimeEnd"}})],1),a("el-form-item",{staticClass:"option-item",attrs:{label:"内容分类："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.searchParams.taskContentCategory,callback:function(t){e.$set(e.searchParams,"taskContentCategory",t)},expression:"searchParams.taskContentCategory"}},[a("el-option",{attrs:{label:"营销软文",value:"0"}}),a("el-option",{attrs:{label:"调研问卷",value:"1"}})],1)],1),a("el-form-item",{staticClass:"option-item",attrs:{label:"内容类型："}},[a("el-select",{attrs:{placeholder:"请选择",disabled:"1"===e.searchParams.taskContentCategory},model:{value:e.searchParams.resourceType,callback:function(t){e.$set(e.searchParams,"resourceType",t)},expression:"searchParams.resourceType"}},[a("el-option",{attrs:{label:"全部",value:"-1"}}),a("el-option",{attrs:{label:"链接",value:"1"}}),a("el-option",{attrs:{label:"视频",value:"2"}}),a("el-option",{attrs:{label:"图文",value:"3"}})],1)],1)],1),a("el-form",{staticClass:"options-form",attrs:{inline:!0,model:e.searchParams}},[a("el-form-item",{staticClass:"option-item",attrs:{label:"渠道分类："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.searchParams.channelCategory,callback:function(t){e.$set(e.searchParams,"channelCategory",t)},expression:"searchParams.channelCategory"}},[a("el-option",{attrs:{label:"个人号",value:"0"}})],1)],1),a("el-form-item",{staticClass:"option-item",attrs:{label:"渠道类型："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.searchParams.nickName,callback:function(t){e.$set(e.searchParams,"nickName",t)},expression:"searchParams.nickName"}},e._l(e.searchConditions,function(t,s){return a("el-option",{key:s,attrs:{label:t.nickName,value:t.nickName}},[e._v("\n                            "+e._s(t.nickName)+"\n                        ")])}))],1),a("el-form-item",{staticClass:"option-item",attrs:{label:"发送状态："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.searchParams.taskSendStatus,callback:function(t){e.$set(e.searchParams,"taskSendStatus",t)},expression:"searchParams.taskSendStatus"}},[a("el-option",{attrs:{label:"全部",value:"-1"}}),a("el-option",{attrs:{label:"未发送",value:"0"}}),a("el-option",{attrs:{label:"发送中",value:"1"}}),a("el-option",{attrs:{label:"已发送",value:"2"}})],1)],1)],1),a("el-form",{attrs:{inline:!0}},[a("el-form-item",[a("div",{staticClass:"label-container"},[a("span",{staticClass:"label-title"},[e._v("用户标签：")]),a("label-picker",{attrs:{searchFunc:e.searchFunc,labels:e.labels,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0)},on:{pickLabel:e.pickLabel,deleteLabel:e.deleteLabel}})],1)]),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")])],1)],1)],1)]),a("div",{staticClass:"list"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),a("el-table-column",{attrs:{label:e.contentIDName,prop:"resources.resourceId"}}),a("el-table-column",{attrs:{label:"标题",prop:"resources.title"}}),a("el-table-column",{attrs:{label:"内容",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.resources.resourceType||4===t.row.resources.resourceType?[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){e.showPreview(t.row.resources)}}},[e._v("\n                            "+e._s(e.shortcutLinkUrl(t.row.resources.linkUrl))+"\n                        ")])]:e._e(),2===t.row.resources.resourceType?[a("div",{staticClass:"video-wrapper",on:{click:function(a){e.showPreview(t.row.resources)}}},[a("video",{staticClass:"table-video",attrs:{src:t.row.resources.vedioUrl,controls:""}}),a("div",{staticClass:"video-mask"},[a("span",{staticClass:"video-duration"},[e._v(e._s(e.videoLength(t.row.resources.vedioLength)))])])])]:e._e(),3===t.row.resources.resourceType?[a("img",{staticClass:"table-img",attrs:{src:t.row.resources.imageUrl},on:{click:function(a){e.showPreview(t.row.resources)}}})]:e._e()]}}])}),a("el-table-column",{attrs:{label:"内容类型",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.resourceType(t.row.resources.resourceType))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"发送时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.timeFormat(t.row.taskSendTime))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"发送成功",prop:"taskSendSuccess"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.taskSendSuccess||0)+"人\n                ")]}}])}),a("el-table-column",{attrs:{label:"发送失败",prop:"taskSendSuccess"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.taskSendFail||0)+"人\n                ")]}}])}),a("el-table-column",{attrs:{label:"发送状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.taskSendStatus(t.row.taskSendStatus))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleView(t.$index,t.row)}}},[e._v("查看")]),0!==t.row.taskSendStatus?a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleExport(t.$index,t.row)}}},[e._v("导出")]):e._e(),0===t.row.taskSendStatus?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")]):e._e()]}}])})],1),a("el-row",{staticClass:"footer-pagination"},[a("el-pagination",{attrs:{"current-page":e.paging.page,"page-sizes":[10,30,50],"page-size":e.paging.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.paging.total},on:{"current-change":e.pageChange,"size-change":e.sizeChange}})],1)],1),a("preview",{attrs:{visible:e.previewVisible,srcType:e.previewData.type,src:e.previewUrl(e.previewData.url,e.previewData.type)},on:{hidden:e.hidePreview}})],1)},Ft=[],Bt={methods:{videoLength:function(e){if(e){var t=this.prefixZero(Math.floor(e/1440)),a=this.prefixZero(Math.floor((e-60*t*24)/60)),s=this.prefixZero(e-60*t*24-60*a);return"".concat(t,":").concat(a,":").concat(s)}return""},prefixZero:function(e){if(!e)return"00";var t="0".concat(e);return t.length>2?t.slice(1):t},previewUrl:function(e,t){return e&&"string"===typeof e&&"link"===t?"".concat(e).concat(e.indexOf("?")>-1?"&":"?","preview=1"):e},shortcutLinkUrl:function(e){return e?"".concat(e.slice(0,-6),"******"):""}}},Ut=a("b17e"),Ot="/crm/label/search.json",qt="/task/findTaskList.json",At="/task/findTaskCondition.json",Ht="/task/deleteTaskById.json",Gt="/task/exportTaskById.json",Qt={name:"groupMsgList",mixins:[Bt],data:function(){return{searchParams:{taskTitle:"",taskSendTimeStart:"",taskSendTimeEnd:"",taskContentCategory:"0",resourceType:"-1",channelCategory:"0",nickName:"",taskSendStatus:"-1",labels:""},searchConditions:[],labels:[],tableData:[],paging:{page:1,pageSize:10,total:0},selectedResource:{},previewVisible:!1,contentIDName:"内容ID"}},methods:{searchFunc:function(e){var t={labelPartitions:"1,3",labelGroupId:0};return e&&(t.labelName=e),this.$get(Ot,t).then(function(e){var t=e.data.object;return t&&t.length?(t.forEach(function(e){e.closable=!0}),Promise.resolve(t)):Promise.resolve([])})},pickLabel:function(e){e&&-1===this.findLabelIndex(e)&&this.labels.push(e)},deleteLabel:function(e){if(e){var t=this.findLabelIndex(e);t>-1&&this.labels.splice(t,1)}},findLabelIndex:function(e){return this.labels.findIndex(function(t){return t.labelId===e.labelId})},handlePage:function(e){return e&&(e.page=this.paging.page,e.pageSize=this.paging.pageSize),e},handleLabels:function(e){var t=[];return this.labels.forEach(function(e){return t.push(e.labelId)}),e.labels=t.join(","),e},handleSendTime:function(e){if(this.searchParams.taskSendTimeStart)e.taskSendTimeStart=qe.formatDate(this.searchParams.taskSendTimeStart,"yyyy-MM-dd hh:mm:ss"),this.searchParams.taskSendTimeEnd&&(e.taskSendTimeEnd=qe.formatDate(this.searchParams.taskSendTimeEnd,"yyyy-MM-dd hh:mm:ss"));else if(this.searchParams.taskSendTimeEnd)return this.$alert("请选择发送时间！"),!1;return this.searchParams.taskSendTimeEnd&&this.searchParams.taskSendTimeEnd&&this.searchParams.taskSendTimeEnd<=this.searchParams.taskSendTimeStart?(this.$alert("发送结束时间应晚于发送开始时间！"),!1):e},handleParams:function(){var e=Ut.clone(this.searchParams);return this.handlePage(e),this.handleLabels(e),!!this.handleSendTime(e)&&e},findTaskList:function(){var e=this;if(!this.findTaskList.busy){this.findTaskList.busy=!0;var t=this.handleParams();t?(this.$loading(),this.$get(qt,t).then(function(t){e.tableData=t.data.object.list,e.paging=t.data.object.paging,e.switchContentIDName()}).finally(function(){e.findTaskList.busy=!1,e.$loading().close()})):this.findTaskList.busy=!1}},findTaskCondition:function(){var e=this;return this.$get(At).then(function(t){e.searchConditions=t.data.object})},resourceType:function(e){switch(e){case 1:return"链接";case 2:return"视频";case 3:return"图文";default:return""}},taskSendStatus:function(e){switch(e){case 0:return"未发送";case 1:return"发送中";case 2:return"已发送";default:return""}},pageChange:function(e){this.paging.page=e,this.findTaskList()},sizeChange:function(e){this.paging.pageSize=e,this.findTaskList()},resetChange:function(){this.paging.page=1},newGroupMsg:function(){this.$router.push("/groupMsg/edit")},search:function(){this.resetChange(),this.findTaskList()},handleView:function(e,t){t&&t.taskId&&this.$router.push("/groupMsg/detail/".concat(t.taskId))},handleExport:function(e,t){window.open("".concat(Gt,"?taskId=").concat(t.taskId))},handleDelete:function(e,t){var a=this;this.handleDelete.busy||(this.handleDelete.busy=!0,this.$confirm("确定删除此".concat(this.resourceType(t.resources.resourceType),"?"),"提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(function(){return a.$post(Ht,{taskId:t.taskId})}).then(function(){a.findTaskList()}).finally(function(){a.handleDelete.busy=!1}))},showPreview:function(e){this.selectedResource=e,this.previewVisible=!0},hidePreview:function(){this.previewVisible=!1},switchContentIDName:function(){"0"!==this.searchParams.taskContentCategory?this.contentIDName="问卷ID":this.contentIDName="内容ID"},timeFormat:function(e){return e?qe.formatDate(new Date(e),"yyyy-MM-dd hh:mm:ss"):""}},computed:{previewData:function(){var e=this.selectedResource,t={},a="",s="";switch(e.resourceType){case 1:case 4:a=e.linkUrl,s="link";break;case 2:a=e.vedioUrl,s="video";break;case 3:a=e.imageUrl,s="image";break;default:break}return t.url=a,t.type=s,t}},created:function(){this.findTaskCondition(),this.findTaskList()}},Vt=Qt,Kt=(a("a3f4"),Object(l["a"])(Vt,zt,Ft,!1,null,"79644471",null));Kt.options.__file="groupMsgList.vue";var Wt=Kt.exports,Jt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[a("el-row",[a("el-col",{attrs:{span:2}},[a("span",[e._v("新建")])]),a("el-col",{attrs:{span:22}},[a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-back"},on:{click:e.back}},[e._v("返回")])],1)])],1)],1),a("el-form",{ref:"addTask",staticClass:"form-container",attrs:{"label-position":"left",model:e.form,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"文字："}},[a("el-input",{attrs:{placeholder:"请描述将要发送内容的说明，增加前端用户体验"},model:{value:e.form.taskTitle,callback:function(t){e.$set(e.form,"taskTitle",t)},expression:"form.taskTitle"}},[a("template",{slot:"append"},[a("span",[e._v(e._s(e.form.taskTitle.length))]),e._v("/"),a("span",[e._v("30")])])],2)],1),a("el-form-item",{attrs:{label:"内容类型：",prop:"resourceId"}},[a("el-button",{attrs:{type:"primary",disabled:e.isSelectResource},on:{click:e.selectFromLib}},[e._v("从内容库选择")]),a("span",{staticClass:"select-tip"},[e._v("目前只支持单选内容。")]),e.selectedResource?a("div",{staticClass:"resource-container"},[1===e.selectedResource.resourceType||4===e.selectedResource.resourceType?[a("div",{staticClass:"resource"},[a("a",{staticClass:"resource-url",attrs:{href:"javascript:void(0)"},on:{click:e.showPreview}},[e._v(e._s(e.shortcutLinkUrl(e.selectedResource.linkUrl)))])])]:2===e.selectedResource.resourceType?[a("div",{staticClass:"resource",on:{click:e.showPreview}},[a("video",{staticClass:"video-max",attrs:{controls:"",preload:"auto",src:e.selectedResource.vedioUrl,alt:""}}),e.previewVisible?e._e():a("div",{staticClass:"video-mask"},[a("span",{staticClass:"video-duration"},[e._v(e._s(e.videoLength(e.selectedResource.vedioLength)))])])])]:[a("div",{staticClass:"resource"},[a("img",{staticClass:"picture-max",attrs:{src:e.selectedResource.imageUrl,alt:""},on:{click:e.showPreview}})])],a("div",{staticClass:"delete-btn-wrapper"},[a("el-button",{staticClass:"delete-btn",attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:e.deleteResource}})],1)],2):e._e()],1),a("el-form-item",{attrs:{label:"用户标签："}},[a("label-picker",{attrs:{searchFunc:e.labelSearch,labels:e.labels,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0)},on:{pickLabel:e.pickLabel,deleteLabel:e.deleteLabel}})],1),a("el-form-item",{attrs:{label:"渠道分类：",prop:"channelCategory"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.channelCategory,callback:function(t){e.$set(e.form,"channelCategory",t)},expression:"form.channelCategory"}},[a("el-option",{attrs:{label:"个人号",value:"0"}})],1)],1),a("el-form-item",{attrs:{label:"渠道类型：",prop:"channels"}},[a("label-picker",{attrs:{searchFunc:e.channelSearch,labels:e.channels,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0),disabled:e.isChannelSelectDisabled},on:{pickLabel:e.channelPick,deleteLabel:e.deleteChannel}})],1),a("el-form-item",{staticStyle:{"margin-top":"10px"}},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.formValidate("addTask")}}},[e._v("实时发送")]),a("el-button",{on:{click:function(t){e.formValidate("addTask",!0)}}},[e._v("定时发送")])],1)],1),a("el-dialog",{attrs:{title:"选择内容",visible:e.contentSelectDialogVisible,width:"60%"},on:{"update:visible":function(t){e.contentSelectDialogVisible=t}}},[a("content-libiary",{on:{"select-confirm":e.selectConfirm,"cancel-select":function(t){e.contentSelectDialogVisible=!1}}})],1),a("el-dialog",{attrs:{title:"定时群发",visible:e.sendTaskDialogVisible,width:"30%"},on:{"update:visible":function(t){e.sendTaskDialogVisible=t}}},[a("p",{staticStyle:{"font-size":"16px","margin-bottom":"20px"}},[e._v("请选择时间：")]),a("el-form",{ref:"timeForm",attrs:{"label-position":"left","label-width":"70px",model:e.timeForm,rules:e.timeRules}},[a("el-form-item",{attrs:{label:"日期：",prop:"sendDate"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","picker-options":e.datePickerOptions},on:{change:e.dateChange},model:{value:e.timeForm.sendDate,callback:function(t){e.$set(e.timeForm,"sendDate",t)},expression:"timeForm.sendDate"}})],1),a("el-form-item",{attrs:{label:"时间：",prop:"sendTime"}},[a("el-time-picker",{attrs:{disabled:e.is11After10Min(e.timeForm.sendDate||new Date),placeholder:"选择时间","picker-options":e.timePickerOptions},model:{value:e.timeForm.sendTime,callback:function(t){e.$set(e.timeForm,"sendTime",t)},expression:"timeForm.sendTime"}})],1),a("el-form-item",[a("p",[e._v("最早发送时间为当前时间的10分钟后。")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.sendTaskDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.performSendScheduled("timeForm")}}},[e._v("确 定")])],1)],1),a("preview",{attrs:{visible:e.previewVisible,srcType:e.previewData.type,src:e.previewUrl(e.previewData.url,e.previewData.type)},on:{hidden:e.hidePreview}})],1)},Zt=[],Yt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.visible?a("div",{staticClass:"mask",on:{click:e.triggerHidden}},["link"===e.srcType?a("div",{staticClass:"device"},[a("div",{staticClass:"device-content"},[a("div",{attrs:{id:"iwindow"}},[a("iframe",{attrs:{src:e.src,width:"320",height:"569",frameborder:"0"}})])])]):e._e(),"video"===e.srcType?a("video",{staticClass:"video",attrs:{src:e.src,controls:""}}):e._e(),"image"===e.srcType?a("img",{staticClass:"image",attrs:{src:e.src}}):e._e()]):e._e()},Xt=[],ea={name:"preview",props:{src:{type:String,validator:function(e){return void 0!==e}},visible:{type:Boolean,default:!1},srcType:{type:String,validator:function(e){return["link","video","image"].indexOf(e)>-1}}},methods:{triggerHidden:function(){this.$emit("hidden")}}},ta=ea,aa=(a("076f"),Object(l["a"])(ta,Yt,Xt,!1,null,"324e86e4",null));aa.options.__file="preview.vue";var sa=aa.exports,ia=a("ade3"),na=a("5c96"),la=a.n(na),ra={},oa=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get",s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return h.a.request((t={url:e,method:a},Object(ia["a"])(t,"get"===a.toLowerCase()?"params":"data",s),Object(ia["a"])(t,"headers",i),t)).then(function(e){return-100===e.data.retcode?(window.location="/login",Promise.reject(new Error("not login"))):200===e.data.retcode?Promise.resolve(e):(na["MessageBox"].alert(e.data.retdesc||"服务异常","提示",{confirmButtonText:"确定"}),Promise.reject(e))},function(e){return 302===e.response.status?(window.location="/login",Promise.reject(e)):(na["MessageBox"].alert("服务异常","提示",{confirmButtonText:"确定"}),Promise.reject(e))}).catch(function(e){return console.log(e),Promise.reject(e)})},ca=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return oa(e,"get",t,a)},ua=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return oa(e,"post",t,a)};ra.install=function(e){e.prototype.$get=ca,e.prototype.$post=ua},s["default"].use(ra);var da=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticClass:"content-nav-container"},[a("el-col",{attrs:{span:6}},[a("el-menu",{staticClass:"content-nav",attrs:{"default-active":"1"},on:{select:e.selectMenu}},[a("el-menu-item",{attrs:{index:"1"}},[a("i",{staticClass:"el-icon-menu"}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("链接")])]),a("el-menu-item",{attrs:{index:"2"}},[a("i",{staticClass:"el-icon-menu"}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("视频")])]),a("el-menu-item",{attrs:{index:"3"}},[a("i",{staticClass:"el-icon-menu"}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("图片")])]),a("el-menu-item",{attrs:{index:"4"}},[a("i",{staticClass:"el-icon-menu"}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("问卷")])])],1)],1),a("el-col",{attrs:{span:18}},[a("search-list",{class:"1"===e.currentListIndex?"show":"hide",attrs:{resourceType:1,btnName:"新建图文"},on:{select:e.select,"clear-selected":e.clearSelected}}),a("search-list",{class:"2"===e.currentListIndex?"show":"hide",attrs:{resourceType:2,btnName:"添加视频"},on:{select:e.select,"clear-selected":e.clearSelected}}),a("search-list",{class:"3"===e.currentListIndex?"show":"hide",attrs:{resourceType:3,btnName:"上传图片"},on:{select:e.select,"clear-selected":e.clearSelected}}),a("search-list",{class:"4"===e.currentListIndex?"show":"hide",attrs:{resourceType:4},on:{select:e.select,"clear-selected":e.clearSelected}})],1)],1),a("el-row",{staticClass:"content-select-operation"},[a("el-col",{staticClass:"content-select-tip",attrs:{span:6}},[a("span",[e._v("已选")]),e._v(e._s(e.selectedResource[e.currentListIndex].length)),a("span",[e._v("个")]),e._v("，"),a("span",[e._v("可选")]),e._v("1"),a("span",[e._v("个")])]),a("el-col",{staticClass:"content-select-btns",attrs:{span:10,offset:8}},[a("el-button",{staticStyle:{width:"150px"},attrs:{type:"danger",disabled:0===e.selectedResource[e.currentListIndex].length},on:{click:e.selectConfirm}},[e._v("确定")]),a("el-button",{staticStyle:{width:"150px"},on:{click:e.cancelSelect}},[e._v("取消")])],1)],1)],1)},ha=[],ma=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list-container"},[a("div",{staticClass:"search-header"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",[a("el-input",{staticClass:"round-input",attrs:{placeholder:"请按标题关键字搜索","prefix-icon":"el-icon-search"},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchByKey}},[e._v("查询")])],1),e.btnName?a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"danger"},on:{click:e.newResource}},[e._v(e._s(e.btnName))])],1):e._e()],1)],1),a("div",{staticClass:"search-list"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isSearching,expression:"isSearching"}],ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"内容ID",property:"resourceId"}}),a("el-table-column",{attrs:{label:"标题",property:"title"}}),a("el-table-column",{attrs:{label:"内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.resourceType?[e._v("\n                        "+e._s(e.shortcutLinkUrl(t.row.linkUrl))+"\n                    ")]:e._e(),2===t.row.resourceType?[a("div",{staticClass:"video-wrapper"},[a("video",{staticClass:"table-video",attrs:{src:t.row.vedioUrl,controls:""}}),a("div",{staticClass:"video-mask"},[a("span",{staticClass:"video-duration"},[e._v(e._s(e.videoLength(t.row.vedioLength)))])])])]:e._e(),3===t.row.resourceType?[a("img",{staticClass:"table-img",attrs:{src:t.row.imageUrl}})]:e._e(),4===t.row.resourceType?[e._v("\n                        "+e._s(e.shortcutLinkUrl(t.row.linkUrl))+"\n                    ")]:e._e()]}}])}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.timeFormat(t.row.createTime))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.timeFormat(t.row.lastUpdateTime))+"\n                ")]}}])})],1),a("el-row",{staticClass:"footer-pagination"},[a("el-pagination",{attrs:{"current-page":e.paging.page,"page-sizes":[e.paging.pageSize],"page-size":e.paging.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.paging.total},on:{"current-change":e.pageChange}})],1)],1)])},pa=[],fa="/resources/findResourcesByType.json",va={name:"searchList",mixins:[Bt],data:function(){return{currentRow:{},tableData:[],searchKey:"",paging:{page:1,pageSize:10,total:0},isSearching:!1}},props:{resourceType:{type:Number,default:1},btnName:{type:String,default:""}},methods:{handleCurrentChange:function(e){this.currentRow=e,this.$emit("select",e)},searchParam:function(){var e=this.paging,t=e.page,a=e.pageSize,s=this.resourceType,i={page:t,pageSize:a,resourceType:s};return this.searchKey&&(i.title=this.searchKey),i},search:function(){var e=this;this.search.busy||(this.search.busy=!0,this.isSearching=!0,this.$get(fa,this.searchParam()).then(function(t){var a=t.data.object,s=a.list,i=a.paging;e.tableData=s,e.paging.total=i.total}).finally(function(){e.search.busy=!1,e.isSearching=!1}))},searchByKey:function(){this.paging.page=1,this.$emit("clear-selected",this.currentRow),this.currentRow={},this.search()},pageChange:function(e){this.paging.page=e,this.search()},timeFormat:function(e){return e?qe.formatDate(new Date(e),"yyyy-MM-dd hh:mm:ss"):""},newResource:function(){switch(this.resourceType){case 1:this.$router.push("/marketing/ad/edit");break;case 2:this.$router.push("/marketing/video/edit");break;case 3:this.$router.push("/marketing/picture/edit");break;case 4:this.$router.push("/question/detail");break;default:break}}},mounted:function(){this.search()}},ba=va,ga=(a("98fb"),Object(l["a"])(ba,ma,pa,!1,null,"40b00574",null));ga.options.__file="searchList.vue";var ya=ga.exports,_a={name:"contentLibrary",data:function(){return{currentListIndex:"1",selectedResource:{1:[],2:[],3:[],4:[]}}},components:{searchList:ya},methods:{selectMenu:function(e){this.currentListIndex=e},select:function(e){if(e){var t=this.selectedResource[this.currentListIndex].findIndex(function(t){return t.resourceId===e.resourceId});-1===t&&this.selectedResource[this.currentListIndex].splice(0,1,e)}},clearSelected:function(e){if(e){var t=this.selectedResource[this.currentListIndex].findIndex(function(t){return t.resourceId===e.resourceId});t>-1&&this.selectedResource[this.currentListIndex].splice(t,1)}},selectConfirm:function(){this.$emit("select-confirm",this.selectedResource[this.currentListIndex])},cancelSelect:function(){this.$emit("cancel-select")},clearSelectedResource:function(){this.selectedResource={1:[],2:[],3:[],4:[]}}}},ka=_a,Ca=(a("4bbc"),Object(l["a"])(ka,da,ha,!1,null,"34b5f92f",null));Ca.options.__file="contentLibrary.vue";var wa=Ca.exports,Sa="/crm/label/search.json",xa="/task/findTaskCondition.json",$a="/task/addTask.json",Ia=36e5,La=6e4,Ta=1e3,Da=10,ja=function(e,t,a){return function(s){var i=e(s);return ca(t,i).then(function(e){var t=e.data.object;return t&&t.length?(a(t),Promise.resolve(t)):Promise.resolve(t)})}},Pa={name:"groupMsgEdit",mixins:[Bt],data:function(){return{form:{taskTitle:"",resourceId:"",labels:"",channelCategory:"",channels:""},rules:{resourceId:[{required:!0,message:"请选择内容类型",trigger:"blur"}],channelCategory:[{required:!0,message:"请选择渠道类型",trigger:"blur"}],channels:[{required:!0,message:"请选择渠道类型",trigger:"blur"}]},timeRules:{sendDate:[{required:!0,message:"请选择发送日期",trigger:"blur"}],sendTime:[{required:!0,message:"请选择发送时间",trigger:"blur"}]},labels:[],channels:[],timeForm:{sendDate:"",sendTime:""},datePickerOptions:{disabledDate:function(){return!0}},timePickerOptions:{selectableRange:""},sendTaskDialogVisible:!1,contentSelectDialogVisible:!1,previewVisible:!1,selectedResource:""}},components:{contentLibiary:wa,preview:sa},methods:{selectFromLib:function(){this.contentSelectDialogVisible=!0},labelSearch:ja(function(e){var t={labelType:1,labelPartitions:"1,3",labelGroupId:0};return e&&(t.labelName=e),t},Sa,function(e){return e.forEach(function(e){e.closable=!0}),e},void 0),pickLabel:function(e){e&&-1===this.findLabelIndex(e)&&this.labels.push(e)},deleteLabel:function(e){if(e){var t=this.findLabelIndex(e);t>-1&&this.labels.splice(t,1)}},findLabelIndex:function(e){return this.labels.findIndex(function(t){return t.labelId===e.labelId})},channelSearch:ja(function(e){var t={};return e&&(t.nickName=e),t},xa,function(e){return e.forEach(function(e){e.closable=!0,e.labelName=e.nickName}),e}),channelPick:function(e){e&&-1===this.findChannelIndex(e)&&this.channels.push(e)},deleteChannel:function(e){if(e){var t=this.findChannelIndex(e);t>-1&&this.channels.splice(t,1)}},findChannelIndex:function(e){return this.channels.findIndex(function(t){return t.wechatId===e.wechatId})},sendPramHandle:function(e){var t=this.form;if(e&&this.timeForm.sendDate&&this.timeForm.sendTime&&(t.cronTime="".concat(qe.formatDate(this.timeForm.sendDate,"yyyy-MM-dd")," ").concat(qe.formatDate(this.timeForm.sendTime,"hh:mm:ss"))),this.labels&&this.labels.length){var a=this.labels.map(function(e){return e.labelId});t.labels=a.join(",")}else t.labels="";return t},handleChannels:function(e){if(e&&e.length){var t=[];return e.forEach(function(e){t.push({wechatId:e.wechatId,channelId:e.channelId,nickName:e.nickName})}),JSON.stringify(t)}return""},formValidate:function(e,t){var a=this;this.$refs[e].validate(function(e){return e&&(t?a.sendScheduled():a.sendImmediately()),!1})},sendImmediately:function(){var e=this;this.sendImmediately.busy||(this.sendImmediately.busy=!0,this.$confirm("是否确认发送，确认后系统立刻发送，请谨慎操作。","实时发送",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(this.sendTask.bind(this,!1)).finally(function(){e.sendImmediately.busy=!1,e.$loading().close()}))},getDateAfter10Min:function(e){return e.setMinutes(e.getMinutes()+10),e},is11After10Min:function(e){if(e){var t=new Date(e.getTime()),a=this.cutTime(t);return a.setHours(22),(a.getTime()-e.getTime())/La<Da}return!1},getSelectableRange:function(e){if(e){var t=new Date;return e.getTime()<=t.getTime()?"".concat(qe.formatDate(this.getDateAfter10Min(t),"hh:mm:ss")," - 22:59:59"):"07:00:00 - 22:59:59"}return"07:00:00 - 22:59:59"},cutTime:function(e){var t=new Date(e.getTime()),a=t.getHours(),s=t.getMinutes(),i=t.getSeconds(),n=t.getMilliseconds();return t.setTime(t.getTime()-a*Ia-s*La-i*Ta-n),t},sendScheduled:function(){var e=this,t=new Date,a=this.cutTime(t);this.datePickerOptions.disabledDate=function(s){return s.getTime()<a.getTime()||s.getTime()===a.getTime()&&e.is11After10Min(t)},this.timePickerOptions.selectableRange=this.getSelectableRange(t),this.sendTaskDialogVisible=!0},performSendScheduled:function(e){var t=this;this.performSendScheduled.busy||(this.performSendScheduled.busy=!0,this.$refs[e].validate(function(e){return e&&t.sendTask(!0).finally(function(){t.performSendScheduled.busy=!1,t.$loading().close()}),!1}))},sendTask:function(e){var t=this;return this.$loading(),this.$post($a,this.sendPramHandle(e)).then(function(){t.$router.push("/groupMsg/list"),t.$loading().close()})},dateChange:function(e){this.timePickerOptions.selectableRange=this.getSelectableRange(e)},selectConfirm:function(e){this.contentSelectDialogVisible=!1,this.selectedResource=e[0],this.form.resourceId=e[0].resourceId},getResourceTypeName:function(){switch(this.selectedResource.resourceType){case 1:return"链接";case 2:return"视频";case 3:return"图片";case 4:return"问卷";default:return""}},deleteResource:function(){var e=this;this.$confirm("是否删除".concat(this.getResourceTypeName(),"？")).then(function(){e.selectedResource=""})},showPreview:function(){this.previewVisible=!0},hidePreview:function(){this.previewVisible=!1},back:function(){this.$router.back()}},computed:{previewData:function(){var e=this.selectedResource,t={},a="",s="";switch(e.resourceType){case 1:case 4:a=e.linkUrl,s="link",console.log("link");break;case 2:a=e.vedioUrl,s="video";break;case 3:a=e.imageUrl,s="image";break;default:break}return t.url=a,t.type=s,t},isSelectResource:function(){return!!this.selectedResource},isChannelSelectDisabled:function(){return this.channels.length>0}},watch:{"form.taskTitle":function(e){var t=this;e.length>30&&this.$nextTick(function(){t.form.taskTitle=e.substring(0,30)})},channels:function(e){this.form.channels=this.handleChannels(e)}}},Na=Pa,Ma=(a("a924"),Object(l["a"])(Na,Jt,Zt,!1,null,"5b9b8f82",null));Ma.options.__file="groupMsgEdit.vue";var Ea=Ma.exports,Ra=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[a("el-row",[a("el-col",{attrs:{span:2}},[a("span",[e._v("详情")])]),a("el-col",{attrs:{span:22}},[a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-back"},on:{click:e.back}},[e._v("返回")])],1)])],1)],1),a("div",{staticClass:"content"},[a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("文字：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.task.taskTitle))])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("内容ID：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.task.resources.resourceId))])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("标题：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.task.resources.title))])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("内容：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[1===e.task.resources.resourceType||4===e.task.resources.resourceType?[a("div",{staticClass:"resource"},[a("a",{staticClass:"resource-url",attrs:{href:"javascript:void(0)"},on:{click:e.showPreview}},[e._v(e._s(e.shortcutLinkUrl(e.task.resources.linkUrl)))])])]:2===e.task.resources.resourceType?[a("div",{staticClass:"resources",on:{click:e.showPreview}},[a("video",{staticClass:"video-max",attrs:{controls:"",preload:"auto",src:e.task.resources.vedioUrl,alt:""}}),e.previewVisible?e._e():a("div",{staticClass:"video-mask"},[a("span",{staticClass:"video-duration"},[e._v(e._s(e.videoLength(e.task.resources.vedioLength)))])])])]:[a("div",{staticClass:"resources"},[a("img",{staticClass:"picture-max",attrs:{src:e.task.resources.imageUrl,alt:""},on:{click:e.showPreview}})])]],2)],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("内容类型：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.resourceType))])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[a("span",{staticClass:"label-name"},[e._v("用户标签：")])]),a("el-col",{attrs:{span:e.labelContentSpan}},[a("ft-labels",{attrs:{labels:e.task.labels}})],1)],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[a("span",[e._v("渠道分类：")])]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.channelCategory))])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{staticClass:"label-name",attrs:{span:e.labelSpan}},[e._v("渠道类型：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[a("ft-labels",{attrs:{labels:e.task.channels}})],1)],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("发送时间：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.timeFormat(e.task.taskSendTime)))])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("发送成功：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.task.taskSendSuccess)+"人")])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("发送失败：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.task.taskSendFail)+"人")])],1),a("el-row",{staticClass:"content-item",attrs:{gutter:20}},[a("el-col",{attrs:{span:e.labelSpan}},[e._v("发送状态：")]),a("el-col",{attrs:{span:e.labelContentSpan}},[e._v(e._s(e.taskSendStatus))])],1)],1),a("preview",{attrs:{visible:e.previewVisible,srcType:e.previewData.type,src:e.previewUrl(e.previewData.url,e.previewData.type)},on:{hidden:e.hidePreview}})],1)},za=[],Fa="/task/findTaskById.json",Ba={name:"groupMsgDetail",mixins:[Bt],data:function(){return{labelSpan:3,labelContentSpan:21,taskId:0,task:{resources:{title:"",resourceType:"",imageUrl:"",vedioUrl:"",linkUrl:""}},previewVisible:!1}},methods:{findTaskById:function(){var e=this;this.$loading();var t=this.taskId;this.$get(Fa,{taskId:t}).then(function(t){e.task=t.data.object,e.task.channels.forEach(function(e){e.labelName=e.nickName})}).finally(function(){e.$loading().close()})},back:function(){this.$router.back()},showPreview:function(){this.previewVisible=!0},hidePreview:function(){this.previewVisible=!1},timeFormat:function(e){return e?qe.formatDate(new Date(e),"yyyy-MM-dd hh:mm:ss"):""}},computed:{resourceType:function(){switch(this.task.resources.resourceType){case 1:return"链接";case 2:return"视频";case 3:return"图片";case 4:return"问卷";default:return""}},channelCategory:function(){switch(this.task.channelCategory){case 0:return"个人号";default:return""}},taskSendStatus:function(){switch(this.task.taskSendStatus){case 0:return"未发送";case 1:return"发送中";case 2:return"已发送";default:return""}},previewData:function(){var e=this.task.resources,t={},a="",s="";switch(e.resourceType){case 1:case 4:a=e.linkUrl,s="link";break;case 2:a=e.vedioUrl,s="video";break;case 3:a=e.imageUrl,s="image";break;default:break}return t.url=a,t.type=s,t}},created:function(){this.taskId=this.$route.params.taskId},mounted:function(){this.findTaskById()}},Ua=Ba,Oa=(a("76ba"),Object(l["a"])(Ua,Ra,za,!1,null,"32dd9a67",null));Oa.options.__file="groupMsgDetail.vue";var qa=Oa.exports,Aa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("div",{staticClass:"header"},[e._v("\n        调研问卷\n    ")]),a("div",{staticClass:"content"},[a("div",{staticClass:"item"},[a("div",{staticClass:"item-title"},[a("span",[e._v("筛选")]),a("div",{staticClass:"btn-box"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.search()}}},[e._v("查询结果")])],1)]),a("div",{staticClass:"item-content"},[a("div",{staticClass:"search-box"},[a("div",{staticClass:"clear-box"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.clearSearch()}}},[e._v("清除筛选")])],1)]),a("div",{staticClass:"item-list"},[a("span",{staticClass:"search-name"},[e._v("\n                        创建人：\n                    ")]),a("el-select",{attrs:{size:"small"},model:{value:e.searchData.createMan,callback:function(t){e.$set(e.searchData,"createMan",t)},expression:"searchData.createMan"}},e._l(e.createManList,function(e,t){return a("el-option",{key:t,attrs:{label:e.userName,value:e.userId}})}))],1),a("div",{staticClass:"item-list"},[a("span",{staticClass:"search-name"},[e._v("\n                        创建时间：\n                    ")]),a("el-date-picker",{attrs:{type:"datetime",size:"small","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始日期时间"},model:{value:e.searchData.timeMin,callback:function(t){e.$set(e.searchData,"timeMin",t)},expression:"searchData.timeMin"}}),e._v("\n                    至\n                    "),a("el-date-picker",{attrs:{type:"datetime",size:"small","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束日期时间"},model:{value:e.searchData.timeMax,callback:function(t){e.$set(e.searchData,"timeMax",t)},expression:"searchData.timeMax"}}),a("span",{staticClass:"clear",on:{click:function(t){e.clearTime()}}},[e._v("清除")])],1),a("div",{staticClass:"item-list"},[a("el-input",{attrs:{size:"small",placeholder:"问卷标题"},model:{value:e.searchData.keyWord,callback:function(t){e.$set(e.searchData,"keyWord",t)},expression:"searchData.keyWord"}})],1)])]),a("div",{staticClass:"addNew"},[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.addNew()}}},[e._v("添加问卷")])],1),a("div",{staticClass:"item"},[e._m(0),a("div",{staticClass:"item-content padding0"},[a("el-table",{ref:"myTable",attrs:{border:"",data:e.dataList}},[a("el-table-column",{attrs:{prop:"questionId",label:"序号"}}),a("el-table-column",{attrs:{prop:"questionId",label:"问券标题"}}),a("el-table-column",{attrs:{prop:"subjectCount",label:"内容ID"}}),a("el-table-column",{attrs:{prop:"subjectCount",label:"问题数量"}}),a("el-table-column",{attrs:{label:"问券二维码"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{staticClass:"qrCode",attrs:{src:t.row.qrcode},on:{click:function(a){e.lookQrCode(t.row.qrcode)}}})]}}])}),a("el-table-column",{attrs:{prop:"questionUrl",label:"问卷链接"}}),a("el-table-column",{attrs:{prop:"finishCount",label:"完成人数"}}),a("el-table-column",{attrs:{label:"创建时间",width:"165"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e.returnDate(t.row.createTime))+"\n                        ")]}}])}),a("el-table-column",{attrs:{prop:"createUser",label:"创建人"}}),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"middle"},on:{click:function(a){e.lookQuestion(t.row.questionId)}}},[e._v("查看问券")]),a("el-button",{attrs:{type:"text",size:"middle"},on:{click:function(a){e.exportDetail(t.row)}}},[e._v("导出明细")])]}}])})],1)],1)]),a("el-pagination",{attrs:{background:"","current-page":e.searchData.page,"page-size":e.searchData.pageSize,layout:"prev, pager, next",total:1e3},on:{"current-change":e.pageChange}})],1),a("preview",{attrs:{visible:e.qrCodeShow,srcType:"image",src:e.qrCode},on:{hidden:e.hidePreview}})],1)},Ha=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("数据列表")])])}],Ga={name:"questionList",data:function(){return{createManList:["全部","赵四"],qrCode:"",qrCodeShow:!1,total:1e3,dataList:[],searchData:{page:1,pageSize:20,timeMin:"",timeMax:"",createMan:"0",keyWord:""}}},methods:{getUsers:function(){var e=this;this.$get("/question/getUsers.json").then(function(t){e.createManList=t.data.object.list,e.createManList.unshift({userId:"0",userName:"全部"})})},search:function(){var e=new Date(this.searchData.timeMax).getTime(),t=new Date(this.searchData.timeMin).getTime();return e&&t&&e<t?this.$message.error("创建开始时间不能大于结束时间"):(this.searchData.page=1,this.getList(),"")},getList:function(){var e=this;this.$get("/question/getQuestions.json",this.searchData).then(function(t){e.dataList=t.data.object.list,e.total=t.data.object.paging.total})},clearTime:function(){this.searchData.timeMin="",this.searchData.timeMax=""},clearSearch:function(){this.searchData.createMan="全部",this.searchData.timeMin="",this.searchData.timeMax="",this.searchData.keyWord="",this.search()},addNew:function(){this.$router.push("/question/detail")},lookQuestion:function(e){this.$router.push("/question/detail?id=".concat(e||"123"))},exportDetail:function(e){window.open("/question/exportQuestions.json?questionId=".concat(e))},pageChange:function(e){this.searchData.page=e,this.getList()},returnDate:function(e){return te.returnDate(e,"hour")},lookQrCode:function(e){this.qrCodeShow=!0,this.qrCode=e},hidePreview:function(){this.qrCodeShow=!1}},mounted:function(){this.getUsers(),this.search()}},Qa=Ga,Va=(a("9692"),Object(l["a"])(Qa,Aa,Ha,!1,null,"b44a617c",null));Va.options.__file="QuestionList.vue";var Ka=Va.exports,Wa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("div",{staticClass:"header"},[a("div",{staticClass:"header-title"},[e._v(e._s(e.questionId?"问卷详情":"添加问卷"))]),a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){e.back()}}},[e._v("返回")]),e.questionId?e._e():a("el-button",{attrs:{type:"success",size:"small"},on:{click:e.save}},[e._v("保存")])],1),a("div",{staticClass:"content"},[a("div",{staticClass:"item"},[e._m(0),a("div",{staticClass:"item-content"},[a("div",{staticClass:"item-list"},[a("span",{staticClass:"search-name"},[e._v("\n                        问卷标题：\n                    ")]),a("div",{staticClass:"question-title"},[a("el-input",{attrs:{size:"small",maxlength:"30",disabled:!!e.questionId},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name",t)},expression:"params.name"}}),a("div",{staticClass:"num-show"},[e._v("\n                            "+e._s(e.params.name.length)+"/30\n                        ")])],1)]),a("div",{staticClass:"item-list"},[a("span",{staticClass:"search-name"},[e._v("\n                        问卷说明页图片：\n                    ")]),a("el-upload",{staticClass:"avatar-uploader",class:e.noImg(e.params.descriptionImg),attrs:{disabled:!!e.questionId,action:"/uploadImage.html?action=uploadImage","show-file-list":!1,"on-success":e.handleAvatarSuccess1,"before-upload":e.beforeAvatarUpload}},[e.params.descriptionImg?a("img",{staticClass:"avatar",attrs:{src:e.params.descriptionImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("div",{staticClass:"img-remark"},[a("el-checkbox",{attrs:{disabled:!!e.questionId},model:{value:e.params.showDesc,callback:function(t){e.$set(e.params,"showDesc",t)},expression:"params.showDesc"}},[e._v("不显示问卷说明页")]),a("br"),a("span",{staticClass:"font-red"},[e._v("建议尺寸750px*1137px，须150k以下")])],1)],1),a("div",{staticClass:"item-list"},[a("span",{staticClass:"search-name"},[e._v("\n                        背景图片：\n                    ")]),a("el-upload",{staticClass:"avatar-uploader",class:e.noImg(e.params.backgroundImg),attrs:{action:"/uploadImage.html?action=uploadImage","show-file-list":!1,disabled:!!e.questionId,"on-success":e.handleAvatarSuccess2,"before-upload":e.beforeAvatarUpload}},[e.params.backgroundImg?a("img",{staticClass:"avatar",attrs:{src:e.params.backgroundImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._m(1)],1),a("div",{staticClass:"item-list"},[a("span",{staticClass:"search-name font-red"},[e._v("\n                        尾页图片：\n                    ")]),a("el-upload",{staticClass:"avatar-uploader",class:e.noImg(e.params.tailImg),attrs:{action:"/uploadImage.html?action=uploadImage","show-file-list":!1,disabled:!!e.questionId,"on-success":e.handleAvatarSuccess3,"before-upload":e.beforeAvatarUpload}},[e.params.tailImg?a("img",{staticClass:"avatar",attrs:{src:e.params.tailImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._m(2)],1)])]),a("div",{staticClass:"item"},[e._m(3),a("div",{staticClass:"item-content padding0"},[a("br"),a("div",{staticClass:"add-btn-box"},[e.questionId?e._e():a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.addQuestion(0)}}},[e._v("添加选择题")]),e.questionId?e._e():a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.addQuestion(2)}}},[e._v("添加输入框")])],1),e.params.subjects.length?e._e():a("div",{staticClass:"no-question"},[e._v("暂无问题，请点击上方选项添加")]),e._l(e.params.subjects,function(t,s){return a("div",{key:s,staticClass:"question-item"},[a("span",[e._v(e._s(t.subjectName||"请输入问题"))]),2!==t.subjectType?a("span",[e._v("（"+e._s(1===t.subjectType?"多":"单")+"选）")]):e._e(),2!==t.subjectType?a("div",{staticClass:"answer-box"},e._l(t.answers,function(s,i){return a("div",{key:i,staticClass:"answer-item"},[a("div",{staticClass:"label-left"},[1===t.subjectType?a("el-checkbox",{attrs:{disabled:""}},[e._v(e._s(s.answerName||"选项"+e.codeList[i]))]):e._e(),0===t.subjectType?a("el-radio",{attrs:{disabled:"",label:i}},[e._v(e._s(s.answerName||"选项"+e.codeList[i]))]):e._e()],1),a("div",{staticClass:"label-box"},[e.questionId?a("div",e._l(s.labels,function(t,s){return a("el-tag",{key:s},[e._v(e._s(t.labelName))])})):a("div",[a("label-picker",{staticClass:"tag-chosen-field",attrs:{searchFunc:e.searchFunc,labels:s.labels,"auto-search":Boolean(!0),"refresh-after-hide":Boolean(!0)},on:{pickLabel:e.pickLabel,deleteLabel:e.deleteLabel}})],1)])])})):e._e(),2===t.subjectType?a("div",{staticClass:"answer-box w50"},[a("el-input",{attrs:{type:"textarea",disabled:"",autosize:{minRows:4,maxRows:4},resize:"none",placeholder:"请输入内容",maxlength:"100"},model:{value:e.radioList[s],callback:function(t){e.$set(e.radioList,s,t)},expression:"radioList[index1]"}}),a("div",{staticClass:"num-show"},[e._v("\n                            "+e._s(e.radioList[s].length)+"/100\n                        ")])],1):e._e(),e.questionId?e._e():a("div",{staticClass:"edit-box"},[a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){e.editTheQuestion(s)}}},[e._v("编辑")]),0!==s?a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(t){e.upTheQuestion(s)}}},[e._v("上移")]):e._e(),s!==e.params.subjects.length-1?a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(t){e.downTheQuestion(s)}}},[e._v("下移")]):e._e(),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){e.deleteTheQuestion(s)}}},[e._v("删除")])],1)])})],2)])]),a("el-dialog",{attrs:{visible:e.isEdit,width:"50%",title:e.dialogType+"问题"},on:{"update:visible":function(t){e.isEdit=t}}},[e.isEdit?a("div",{staticClass:"question-box"},[a("div",{staticClass:"question-box-item"},[a("div",{staticClass:"question-box-item-title"},[a("span",[e._v("问题")]),2!==e.editQuestion.subjectType?a("div",{staticClass:"choose-box"},[a("el-radio",{attrs:{label:"0"},model:{value:e.editQuestion.subjectType,callback:function(t){e.$set(e.editQuestion,"subjectType",t)},expression:"editQuestion.subjectType"}},[e._v("单选")]),a("el-radio",{attrs:{label:"1"},model:{value:e.editQuestion.subjectType,callback:function(t){e.$set(e.editQuestion,"subjectType",t)},expression:"editQuestion.subjectType"}},[e._v("多选")])],1):e._e()]),a("div",{staticClass:"question-box-item-content"},[a("el-input",{attrs:{placeholder:"请输入问题",maxlength:"30",size:"small"},model:{value:e.editQuestion.subjectName,callback:function(t){e.$set(e.editQuestion,"subjectName",t)},expression:"editQuestion.subjectName"}})],1)]),2!==e.editQuestion.subjectType?a("div",{staticClass:"question-box-item"},[a("div",{staticClass:"question-box-item-title"},[a("span",[e._v("选项")])]),a("div",{staticClass:"question-box-item-content"},e._l(e.editQuestion.answers,function(t,s){return a("div",{key:s,staticClass:"answer-every"},[a("div",{staticClass:"answer-input"},[a("el-input",{attrs:{maxlength:"10",size:"small",placeholder:"请输入选项"+e.codeList[s]},model:{value:t.answerName,callback:function(a){e.$set(t,"answerName",a)},expression:"answer.answerName"}})],1),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.addOption(s)}}},[e._v("增加选项")]),s>1?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){e.deleteOption(s)}}},[e._v("删除选项")]):e._e()],1)}))]):e._e(),a("div",{staticClass:"save-add"},[a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){e.saveOne()}}},[e._v("保存")])],1)]):e._e()])],1)},Ja=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("问卷标题及说明")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"img-remark"},[a("span",{staticClass:"font-red"},[e._v("建议尺寸750px*1137px，须150k以下")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"img-remark"},[a("span",{staticClass:"font-red"},[e._v("建议尺寸750px*1137px，须150k以下")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-title"},[a("span",[e._v("问卷问题")])])}],Za=153600,Ya=["A","B","C","D","E","F","G","H","I","J"],Xa=["","","","","","","","","",""],es={name:"questionDetail",components:{labelPicker:G},props:["id"],data:function(){return{questionId:"",isEdit:!1,codeList:Ya,radioList:Xa,params:{name:"",showDesc:!1,descriptionImg:"",backgroundImg:"",tailImg:"",subjects:[]},editQuestion:{},dialogType:"添加"}},created:function(){this.questionId=this.$route.query.id,this.questionId&&this.getDetail()},methods:{getDetail:function(){var e=this;this.$get("/question/viewQuestion.json",{questionId:this.questionId}).then(function(t){e.params=t.data.object})},handleAvatarSuccess1:function(e){200===e.retcode?(this.$message.success("上传成功"),this.params.descriptionImg=e.imageUrl):this.$alert("上传失败")},handleAvatarSuccess2:function(e){200===e.retcode?(this.$message.success("上传成功"),this.params.backgroundImg=e.imageUrl):this.$alert("上传失败")},handleAvatarSuccess3:function(e){200===e.retcode?(this.$message.success("上传成功"),this.params.tailImg=e.imageUrl):this.$alert("上传失败")},beforeAvatarUpload:function(e){return!(e.size>Za)||(this.$alert("上传图片不能大于150k"),!1)},noImg:function(e){return e?"":"noImg"},save:function(){var e=this;return this.params.name?!this.params.descriptionImg&&this.params.showDesc?this.$message.error("请上传问卷说明页图片"):this.params.backgroundImg?this.params.tailImg?this.params.subjects.length?(this.sortSubjects(),this.params.showDesc=this.params.showDesc?1:0,void this.$post("/question/addQuestion.json",this.params).then(function(){e.$route.push("/question/list")})):this.$message.error("请添加问题"):this.$message.error("请上传尾页图片"):this.$message.error("请上传背景图片"):this.$message.error("请填写问卷标题")},back:function(){var e=this;this.$confirm("数据未保存，是否确认离开页面","提示",{showCancelButton:!0,type:"warning"}).then(function(){e.$router.back()})},addQuestion:function(e){if(this.isEdit)return this.$message.error("请先保存");if(10===this.params.subjects.length)return this.$message.error("问题最多为10个");this.dialogType="添加",this.isEdit=!0;var t={subjectNumber:"",subjectName:"",subjectType:e,answers:[{answerNumber:"1",answerName:"",labels:[]},{answerNumber:"2",answerName:"",labels:[]},{answerNumber:"3",answerName:"",labels:[]}]};return t.subjectNumber=this.params.subjects.length+1,this.editQuestion=t,""},saveOne:function(){var e="",t=this.editQuestion;if(2!==t.subjectType&&t.answers.forEach(function(t){t.answerName||(e="选项不能为空")}),t.subjectName||(e="问题名称不能为空"),e)return this.$message.error(e);t&&t.answers&&t.answers.forEach(function(e){e.labels&&e.labels.length&&(e.labels=[])}),-1===this.params.subjects.indexOf(t)&&this.params.subjects.push(t),this.isEdit=!1},addOption:function(e){if(10===this.editQuestion.answers.length)return this.$message.error("选项最多为10个");var t={answerNumber:"",answerName:"",labels:[]};return this.editQuestion.answers.splice(e+1,0,t),this.updataAnswerNum(),""},deleteOption:function(e){var t=this;this.$confirm("是否确认删掉此选项",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.editQuestion.answers.splice(e,1),t.updataAnswerNum()})},updataAnswerNum:function(){var e=this.editQuestion.answers;e.forEach(function(e,t){e.answerNumber=t+1})},editTheQuestion:function(e){this.dialogType="编辑",this.editQuestion=this.params.subjects[e],this.isEdit=!0},upTheQuestion:function(e){this.params.subjects[e]=this.params.subjects.splice(e-1,1,this.params.subjects[e])[0]},downTheQuestion:function(e){this.params.subjects[e]=this.params.subjects.splice(e+1,1,this.params.subjects[e])[0]},deleteTheQuestion:function(e){var t=this;this.$confirm("是否确认删掉此问题及选项",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.params.subjects.splice(e,1)})},sortSubjects:function(){var e=this.params.subjects;e.forEach(function(e,t){e.subjectNumber=t+1})},searchFunc:function(e){var t={labelPartitions:"2,3",labelPartition:1,labelGroupId:0};return e&&(t.labelName=e),this.$get("/crm/label/search.json",t).then(function(e){var t=e.data.object;return t&&t.length?(t.forEach(function(e){e.closable=!0}),Promise.resolve(t)):Promise.resolve([])})},pickLabel:function(e,t){var a=t.indexOf(e);return a>-1?this.$message.error("已选择此标签"):(t.push(e),"")},deleteLabel:function(e,t){var a=t.indexOf(e);a>-1&&t.splice(a,1)}}},ts=es,as=(a("3e9f"),Object(l["a"])(ts,Wa,Ja,!1,null,"e1b28e40",null));as.options.__file="QuestionDetail.vue";var ss=as.exports;s["default"].use(u["a"]);var is=function(){return{x:0,y:0}},ns=new u["a"]({mode:"history",scrollBehavior:is,routes:[{path:"/",name:"entry",component:k,children:[{path:"index",name:"index",component:Rt,props:!0},{path:"addRelation",name:"addRelation",component:J,props:!0},{path:"tag/detail",name:"tagDetail",component:le,props:!0},{path:"tag/list",name:"tagList",component:ye},{path:"/crm/userList",name:"crmUserList",component:xe,props:!0},{path:"userInfo",name:"userInfo",component:Ee,props:!0},{path:"marketing/list",name:"adList",component:st,props:!0},{path:"marketing/ad/edit",name:"adEdit",component:bt,props:!0},{path:"marketing/picture/edit",name:"pictureEdit",component:wt,props:!0},{path:"marketing/video/edit",name:"videoEdit",component:Dt,props:!0},{path:"groupMsg/list",name:"groupMsgList",component:Wt},{path:"groupMsg/edit",name:"groupMsgEdit",component:Ea},{path:"groupMsg/detail/:taskId",name:"groupMsgDetail",component:qa},{path:"question/list",name:"questionList",component:Ka},{path:"question/detail",name:"questionDetail",component:ss,props:!0}]},{path:"/login",name:"login",component:I},{path:"*",name:"notFound",component:N}]});function ls(){return h.a.request({url:"/checkLogin.json",method:"get"}).then(function(e){return 200===e.data.retcode?Promise.resolve("yes"):Promise.resolve("no")},function(){return Promise.resolve("no")}).catch(function(){return Promise.resolve("no")})}ns.beforeEach(function(e,t,a){var s=e.fullPath;console.log(s),"/"!==s?ls().then(function(e){"/login"===s?"no"===e?a():a("/index"):"yes"===e?a():a("/login")}):a("/index")});var rs=ns;s["default"].use(v["a"]);var os=new v["a"].Store({state:{menu:[],userInfo:{},operationInfo:[]},mutations:{setMenu:function(e,t){e.menu=t},setUserInfo:function(e,t){e.userInfo=t},setOperation:function(e,t){e.operationInfo=t}}});a("0fae");s["default"].use(la.a);var cs=a("ae1a"),us=a.n(cs);a("678d");s["default"].use(us.a);var ds=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",{ref:"popover",attrs:{trigger:e.trigger,"open-delay":e.openDelay,title:e.title,disabled:e.disabled,content:e.content,reference:e.reference,"popper-class":e.popperClass,width:e.width,"visible-arrow":e.visibleArrow,"arrow-offset":e.arrowOffset,transition:e.transition},on:{show:e._show,"after-enter":e._afterEnter,hide:e._hide,"after-leave":e._afterLeave}},[a("div",{staticClass:"search-layer"},[a("div",{staticClass:"search-header"},[a("div",{staticClass:"search-icon-wrapper"},[a("i",{staticClass:"el-icon-search"})]),a("div",{staticClass:"search-input-wrapper"},[a("el-input",{attrs:{placeholder:e.placeHolder},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1)]),a("div",{staticClass:"search-content"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isSearching,expression:"isSearching"}],attrs:{"highlight-current-row":"","show-header":e.showHeader,data:e.renderData},on:{"row-dblclick":e._dbClick}},[e._t("list")],2)],1)]),a("div",{staticStyle:{display:"inline-block"},attrs:{slot:"reference"},slot:"reference"},[e._t("icon")],2)])},hs=[],ms=(a("6b54"),{name:"pick-list-popover",props:{placeHolder:{type:String,default:"请输入内容"},showHeader:{type:Boolean,default:!1},data:{type:Array,default:function(){return[]}},searchFunc:{type:Function,default:function(){return Promise.resolve([])}},autoSearch:{type:Boolean,default:!1},refreshAfterHide:{type:Boolean,default:!1},debounce:{type:Number,default:300},trigger:{type:String,default:"click",validator:function(e){return["click","focus","hover","manual"].indexOf(e)>-1}},openDelay:{type:Number,default:0},title:String,disabled:Boolean,content:String,reference:{},popperClass:String,width:{},visibleArrow:{default:!0},arrowOffset:{type:Number,default:0},transition:{type:String,default:"fade-in-linear"}},data:function(){return{searchKey:"",renderData:this.data,isSearching:!1}},methods:{search:function(e){var t=this;this.search.busy||(this.search.busy=!0,this.isSearching=!0,this.searchFunc(e).then(function(e){"[object Array]"===Object.prototype.toString.call(e)?t.renderData=e:t.renderData=[]}).finally(function(){t.search.busy=!1,t.isSearching=!1}))},_dbClick:function(e,t){this.$emit("pick",e,t)},_show:function(){this.$emit("show")},_afterEnter:function(){this.$emit("after-enter")},_hide:function(){this.$emit("hide")},_afterLeave:function(){this.refreshAfterHide&&(this.searchKey=""),this.$emit("after-leave")}},mounted:function(){this.autoSearch&&this.search()},watch:{searchKey:function(){var e=this;this.timeout||(this.timeout=setTimeout(function(){e.search(e.searchKey),e.timeout=void 0},this.debounce))},disabled:function(e){e&&(this.$refs.popover.showPopper=!1)}}}),ps=ms,fs=(a("fa39"),Object(l["a"])(ps,ds,hs,!1,null,"22f4a2b0",null));fs.options.__file="pick-list-popover.vue";var vs=fs.exports,bs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.labels,function(t,s){return a("el-tag",{key:s,staticClass:"label",attrs:{type:t.type,closable:t.closable,"disable-transitions":t.disableTransitions,hit:t.hit,color:t.color,size:t.size},on:{close:function(t){e._close(s)}}},[e._v("\n        "+e._s(t.labelName)+"\n    ")])}))},gs=[],ys={name:"ft-labels",props:{labels:{type:Array,default:function(){return[]}}},methods:{_close:function(e){this.$emit("deleteLabel",e,this.labels)}}},_s=ys,ks=(a("4e7c"),Object(l["a"])(_s,bs,gs,!1,null,"da1d0c98",null));ks.options.__file="ft-labels.vue";var Cs=ks.exports,ws=[fe,vs,Cs,G,sa];ws.forEach(function(e){return s["default"].component(e.name,e)}),s["default"].config.productionTip=!1,new s["default"]({router:rs,store:os,render:function(e){return e(c)}}).$mount("#app")},"59c4":function(e,t,a){},"5c0b":function(e,t,a){"use strict";var s=a("5e27"),i=a.n(s);i.a},"5e27":function(e,t,a){},"5f0f":function(e,t,a){},"678d":function(e,t,a){},"6afb":function(e,t,a){},"6f68":function(e,t,a){"use strict";var s=a("934e"),i=a.n(s);i.a},7267:function(e,t,a){},"76ba":function(e,t,a){"use strict";var s=a("1dc9"),i=a.n(s);i.a},"88b2":function(e,t,a){"use strict";var s=a("9366"),i=a.n(s);i.a},"8aa8":function(e,t,a){},"8cc5":function(e,t,a){},"934e":function(e,t,a){},9366:function(e,t,a){},"95f7":function(e,t,a){"use strict";var s=a("46be"),i=a.n(s);i.a},9692:function(e,t,a){"use strict";var s=a("f428"),i=a.n(s);i.a},"98fb":function(e,t,a){"use strict";var s=a("59c4"),i=a.n(s);i.a},a132:function(e,t,a){},a3f4:function(e,t,a){"use strict";var s=a("8cc5"),i=a.n(s);i.a},a6a7:function(e,t,a){},a924:function(e,t,a){"use strict";var s=a("0394"),i=a.n(s);i.a},ad01:function(e,t,a){},b2c5:function(e,t,a){"use strict";var s=a("c5d1"),i=a.n(s);i.a},b826:function(e,t,a){"use strict";var s=a("2567"),i=a.n(s);i.a},c5d1:function(e,t,a){},ce8a:function(e,t,a){"use strict";var s=a("4c4a"),i=a.n(s);i.a},d80d:function(e,t,a){},db6f:function(e,t,a){"use strict";var s=a("e8af"),i=a.n(s);i.a},df69:function(e,t,a){"use strict";var s=a("5f0f"),i=a.n(s);i.a},e31a:function(e,t,a){"use strict";var s=a("eeec"),i=a.n(s);i.a},e7aa:function(e,t,a){"use strict";var s=a("4ff4"),i=a.n(s);i.a},e8af:function(e,t,a){},eae3:function(e,t,a){"use strict";var s=a("f86b"),i=a.n(s);i.a},ed12:function(e,t,a){"use strict";var s=a("39ce"),i=a.n(s);i.a},eeec:function(e,t,a){},f11b:function(e,t,a){},f428:function(e,t,a){},f86b:function(e,t,a){},fa39:function(e,t,a){"use strict";var s=a("0641"),i=a.n(s);i.a}});
//# sourceMappingURL=app.1b0d4001.js.map